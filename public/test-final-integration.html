<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ€çµ‚çµ±åˆãƒ†ã‚¹ãƒˆ - BGMå‰Šé™¤å®Œäº†ç¢ºèª</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        
        h1 {
            text-align: center;
            color: #00ff88;
            margin-bottom: 30px;
        }
        
        .test-section {
            background: #2a2a2a;
            border: 2px solid #333;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #00ccff;
        }
        
        .status-good { color: #00ff88; }
        .status-bad { color: #ff4444; }
        .status-warning { color: #ffaa00; }
        
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            font-family: monospace;
        }
        
        .success { background: rgba(0, 255, 136, 0.1); border-left: 4px solid #00ff88; }
        .error { background: rgba(255, 68, 68, 0.1); border-left: 4px solid #ff4444; }
        .warning { background: rgba(255, 170, 0, 0.1); border-left: 4px solid #ffaa00; }
        
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            background: #0066cc;
            color: #fff;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background: #0088ff;
        }
        
        .summary {
            font-size: 20px;
            font-weight: bold;
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .summary.success {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
        }
        
        .summary.failure {
            background: rgba(255, 68, 68, 0.2);
            color: #ff4444;
        }
    </style>
    
    <!-- Tone.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/tone@14.7.77/build/Tone.js"></script>
</head>
<body>
    <h1>ğŸ”¥ æœ€çµ‚çµ±åˆãƒ†ã‚¹ãƒˆ - BGMå‰Šé™¤å®Œäº†ç¢ºèª</h1>
    
    <!-- ã‚·ã‚¹ãƒ†ãƒ æ¤œè¨¼ -->
    <div class="test-section">
        <div class="section-title">1. ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆæ¤œè¨¼</div>
        <button onclick="runSystemTests()">ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <div id="system-results"></div>
    </div>
    
    <!-- éŸ³éŸ¿ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ -->
    <div class="test-section">
        <div class="section-title">2. éŸ³éŸ¿ã‚·ã‚¹ãƒ†ãƒ æ¤œè¨¼</div>
        <button onclick="runAudioTests()">éŸ³éŸ¿ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <div id="audio-results"></div>
    </div>
    
    <!-- BGMå‰Šé™¤ç¢ºèª -->
    <div class="test-section">
        <div class="section-title">3. BGMæ©Ÿèƒ½å‰Šé™¤ç¢ºèª</div>
        <button onclick="runBGMDeletionTests()">BGMå‰Šé™¤ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <div id="bgm-results"></div>
    </div>
    
    <!-- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ -->
    <div class="test-section">
        <div class="section-title">4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¤œè¨¼</div>
        <button onclick="runPerformanceTests()">ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <div id="performance-results"></div>
    </div>
    
    <!-- ç·åˆçµæœ -->
    <div id="summary"></div>

    <script type="module">
        import { SimpleToneAudioSystem } from './js/systems/audio-system.js';
        import { SettingsSystem } from './js/systems/settings-system.js';
        
        let results = {
            system: [],
            audio: [],
            bgm: [],
            performance: []
        };
        
        function addResult(category, test, status, message) {
            results[category].push({ test, status, message });
            updateDisplay(category);
        }
        
        function updateDisplay(category) {
            const container = document.getElementById(`${category}-results`);
            const categoryResults = results[category];
            
            container.innerHTML = categoryResults.map(result => 
                `<div class="test-result ${result.status}">
                    <strong>${result.test}:</strong> ${result.message}
                </div>`
            ).join('');
        }
        
        function updateSummary() {
            const allResults = Object.values(results).flat();
            const totalTests = allResults.length;
            const passedTests = allResults.filter(r => r.status === 'success').length;
            const failedTests = allResults.filter(r => r.status === 'error').length;
            
            const summaryElement = document.getElementById('summary');
            const passRate = ((passedTests / totalTests) * 100).toFixed(1);
            
            if (failedTests === 0) {
                summaryElement.className = 'summary success';
                summaryElement.innerHTML = `
                    âœ… å…¨ãƒ†ã‚¹ãƒˆåˆæ ¼ï¼<br>
                    ${passedTests}/${totalTests} ãƒ†ã‚¹ãƒˆæˆåŠŸ (${passRate}%)<br>
                    BGMæ©Ÿèƒ½å®Œå…¨å‰Šé™¤ - ã‚·ã‚¹ãƒ†ãƒ ç§»è¡Œå®Œäº† ğŸ‰
                `;
            } else {
                summaryElement.className = 'summary failure';
                summaryElement.innerHTML = `
                    âŒ ãƒ†ã‚¹ãƒˆå¤±æ•—ã‚ã‚Š<br>
                    ${passedTests}/${totalTests} ãƒ†ã‚¹ãƒˆæˆåŠŸ (${passRate}%)<br>
                    ${failedTests} ä»¶ã®å•é¡Œè¦ä¿®æ­£
                `;
            }
        }
        
        async function runSystemTests() {
            try {
                // Tone.jså¯ç”¨æ€§ãƒã‚§ãƒƒã‚¯
                if (typeof Tone !== 'undefined') {
                    addResult('system', 'Tone.jså¯ç”¨æ€§', 'success', 'Tone.jsæ­£å¸¸èª­ã¿è¾¼ã¿');
                } else {
                    addResult('system', 'Tone.jså¯ç”¨æ€§', 'error', 'Tone.jsèª­ã¿è¾¼ã¿å¤±æ•—');
                }
                
                // SimpleToneAudioSystemã‚¤ãƒ³ãƒãƒ¼ãƒˆ
                try {
                    const audioSystem = new SimpleToneAudioSystem({});
                    addResult('system', 'AudioSystemã‚¤ãƒ³ãƒãƒ¼ãƒˆ', 'success', 'SimpleToneAudioSystemæ­£å¸¸ã‚¤ãƒ³ãƒãƒ¼ãƒˆ');
                } catch (error) {
                    addResult('system', 'AudioSystemã‚¤ãƒ³ãƒãƒ¼ãƒˆ', 'error', `ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                }
                
                // SettingsSystemã‚¤ãƒ³ãƒãƒ¼ãƒˆ
                try {
                    const settingsSystem = new SettingsSystem({});
                    addResult('system', 'SettingsSystemã‚¤ãƒ³ãƒãƒ¼ãƒˆ', 'success', 'SettingsSystemæ­£å¸¸ã‚¤ãƒ³ãƒãƒ¼ãƒˆ');
                } catch (error) {
                    addResult('system', 'SettingsSystemã‚¤ãƒ³ãƒãƒ¼ãƒˆ', 'error', `ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                }
                
                // éŸ³é‡è¨­å®šUIè¦ç´ ç¢ºèª
                const masterSlider = document.getElementById('master-volume-slider');
                const sfxSlider = document.getElementById('sfx-volume-slider');
                const bgmSlider = document.getElementById('bgm-volume-slider');
                
                if (!bgmSlider) {
                    addResult('system', 'BGM UIå‰Šé™¤ç¢ºèª', 'success', 'BGMéŸ³é‡ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼æ­£å¸¸å‰Šé™¤');
                } else {
                    addResult('system', 'BGM UIå‰Šé™¤ç¢ºèª', 'error', 'BGMéŸ³é‡ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ãŒæ®‹å­˜');
                }
                
                if (masterSlider && sfxSlider) {
                    addResult('system', 'éŸ³é‡UIç¢ºèª', 'success', 'ãƒã‚¹ã‚¿ãƒ¼ãƒ»åŠ¹æœéŸ³ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼å­˜åœ¨');
                } else {
                    addResult('system', 'éŸ³é‡UIç¢ºèª', 'warning', 'ä¸€éƒ¨éŸ³é‡ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ä¸è¶³');
                }
                
            } catch (error) {
                addResult('system', 'ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ', 'error', `ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
            
            updateSummary();
        }
        
        async function runAudioTests() {
            try {
                // SimpleToneAudioSystemåˆæœŸåŒ–
                await Tone.start();
                const audioSystem = new SimpleToneAudioSystem({});
                await audioSystem.initAudio();
                
                if (audioSystem.isInitialized) {
                    addResult('audio', 'AudioSystemåˆæœŸåŒ–', 'success', 'SimpleToneAudioSystemåˆæœŸåŒ–æˆåŠŸ');
                } else {
                    addResult('audio', 'AudioSystemåˆæœŸåŒ–', 'error', 'SimpleToneAudioSystemåˆæœŸåŒ–å¤±æ•—');
                }
                
                // åŠ¹æœéŸ³å­˜åœ¨ç¢ºèª
                const expectedSounds = ['shoot', 'reload', 'pickup', 'enemyDeath', 'levelUp', 'damage'];
                const actualSounds = Object.keys(audioSystem.sounds);
                
                const missingSounds = expectedSounds.filter(sound => !actualSounds.includes(sound));
                if (missingSounds.length === 0) {
                    addResult('audio', 'åŠ¹æœéŸ³ã‚·ã‚¹ãƒ†ãƒ ', 'success', `å…¨6åŠ¹æœéŸ³æ­£å¸¸ä½œæˆ: ${actualSounds.join(', ')}`);
                } else {
                    addResult('audio', 'åŠ¹æœéŸ³ã‚·ã‚¹ãƒ†ãƒ ', 'error', `ä¸è¶³åŠ¹æœéŸ³: ${missingSounds.join(', ')}`);
                }
                
                // éŸ³é‡åˆ¶å¾¡ãƒ†ã‚¹ãƒˆ
                try {
                    audioSystem.setVolume('master', 0.8);
                    audioSystem.setVolume('sfx', 0.7);
                    
                    const masterVol = audioSystem.getVolume('master');
                    const sfxVol = audioSystem.getVolume('sfx');
                    
                    if (masterVol === 0.8 && sfxVol === 0.7) {
                        addResult('audio', 'éŸ³é‡åˆ¶å¾¡', 'success', 'ãƒã‚¹ã‚¿ãƒ¼ãƒ»åŠ¹æœéŸ³éŸ³é‡åˆ¶å¾¡æ­£å¸¸');
                    } else {
                        addResult('audio', 'éŸ³é‡åˆ¶å¾¡', 'error', `éŸ³é‡è¨­å®šç•°å¸¸: M=${masterVol}, S=${sfxVol}`);
                    }
                } catch (error) {
                    addResult('audio', 'éŸ³é‡åˆ¶å¾¡', 'error', `éŸ³é‡åˆ¶å¾¡ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                }
                
                // BGMéŸ³é‡åˆ¶å¾¡å‰Šé™¤ç¢ºèª
                try {
                    audioSystem.setVolume('bgm', 0.5);
                    addResult('audio', 'BGMéŸ³é‡å‰Šé™¤ç¢ºèª', 'error', 'BGMéŸ³é‡åˆ¶å¾¡ãŒæ®‹å­˜ï¼ˆå‰Šé™¤å¤±æ•—ï¼‰');
                } catch (error) {
                    addResult('audio', 'BGMéŸ³é‡å‰Šé™¤ç¢ºèª', 'success', 'BGMéŸ³é‡åˆ¶å¾¡æ­£å¸¸å‰Šé™¤');
                }
                
            } catch (error) {
                addResult('audio', 'éŸ³éŸ¿ãƒ†ã‚¹ãƒˆ', 'error', `ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
            
            updateSummary();
        }
        
        async function runBGMDeletionTests() {
            try {
                const audioSystem = new SimpleToneAudioSystem({});
                await audioSystem.initAudio();
                
                // BGMãƒ¡ã‚½ãƒƒãƒ‰å‰Šé™¤ç¢ºèª
                const bgmMethods = ['startBGM', 'stopBGM', 'pauseBGM', 'resumeBGM', 'setBGMVolume'];
                const existingBGMMethods = bgmMethods.filter(method => typeof audioSystem[method] === 'function');
                
                if (existingBGMMethods.length === 0) {
                    addResult('bgm', 'BGMãƒ¡ã‚½ãƒƒãƒ‰å‰Šé™¤', 'success', 'å…¨BGMãƒ¡ã‚½ãƒƒãƒ‰æ­£å¸¸å‰Šé™¤');
                } else {
                    addResult('bgm', 'BGMãƒ¡ã‚½ãƒƒãƒ‰å‰Šé™¤', 'error', `æ®‹å­˜BGMãƒ¡ã‚½ãƒƒãƒ‰: ${existingBGMMethods.join(', ')}`);
                }
                
                // BGMã‚·ã‚¹ãƒ†ãƒ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå‰Šé™¤ç¢ºèª
                if (!audioSystem.bgmSystem) {
                    addResult('bgm', 'BGMã‚·ã‚¹ãƒ†ãƒ å‰Šé™¤', 'success', 'BGMã‚·ã‚¹ãƒ†ãƒ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ­£å¸¸å‰Šé™¤');
                } else {
                    addResult('bgm', 'BGMã‚·ã‚¹ãƒ†ãƒ å‰Šé™¤', 'error', 'BGMã‚·ã‚¹ãƒ†ãƒ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæ®‹å­˜');
                }
                
                // BGMã‚·ãƒ³ã‚»ã‚µã‚¤ã‚¶ãƒ¼å‰Šé™¤ç¢ºèª
                const synthKeys = Object.keys(audioSystem.toneSynths);
                const bgmSynths = synthKeys.filter(key => key.includes('bgm') || key.includes('Bgm') || key.includes('BGM'));
                
                if (bgmSynths.length === 0) {
                    addResult('bgm', 'BGMã‚·ãƒ³ã‚»å‰Šé™¤', 'success', 'BGMã‚·ãƒ³ã‚»ã‚µã‚¤ã‚¶ãƒ¼æ­£å¸¸å‰Šé™¤');
                } else {
                    addResult('bgm', 'BGMã‚·ãƒ³ã‚»å‰Šé™¤', 'error', `æ®‹å­˜BGMã‚·ãƒ³ã‚»: ${bgmSynths.join(', ')}`);
                }
                
                // éŸ³é‡è¨­å®šç¢ºèª
                const volumeKeys = Object.keys(audioSystem.volumeSettings);
                if (volumeKeys.includes('bgm')) {
                    addResult('bgm', 'BGMéŸ³é‡è¨­å®šå‰Šé™¤', 'error', 'BGMéŸ³é‡è¨­å®šãŒæ®‹å­˜');
                } else {
                    addResult('bgm', 'BGMéŸ³é‡è¨­å®šå‰Šé™¤', 'success', 'BGMéŸ³é‡è¨­å®šæ­£å¸¸å‰Šé™¤');
                }
                
                // ã‚³ãƒ¼ãƒ‰ã‚µã‚¤ã‚ºç¢ºèªï¼ˆæ¦‚ç®—ï¼‰
                const codeSize = audioSystem.constructor.toString().length;
                if (codeSize < 5000) { // æ¦‚ç®—ã§ã®ç°¡æ½”æ€§ãƒã‚§ãƒƒã‚¯
                    addResult('bgm', 'ã‚³ãƒ¼ãƒ‰ã‚µã‚¤ã‚º', 'success', `ã‚·ãƒ³ãƒ—ãƒ«ãªã‚³ãƒ¼ãƒ‰å®Ÿè£… (~${Math.round(codeSize/1000)}KB)`);
                } else {
                    addResult('bgm', 'ã‚³ãƒ¼ãƒ‰ã‚µã‚¤ã‚º', 'warning', `ã‚³ãƒ¼ãƒ‰ã‚µã‚¤ã‚ºå¤§ (~${Math.round(codeSize/1000)}KB)`);
                }
                
            } catch (error) {
                addResult('bgm', 'BGMå‰Šé™¤ãƒ†ã‚¹ãƒˆ', 'error', `ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
            
            updateSummary();
        }
        
        async function runPerformanceTests() {
            try {
                const audioSystem = new SimpleToneAudioSystem({});
                await audioSystem.initAudio();
                
                // åˆæœŸåŒ–æ™‚é–“ç¢ºèª
                const stats = audioSystem.getPerformanceStats();
                if (stats.initTime < 500) {
                    addResult('performance', 'åˆæœŸåŒ–é€Ÿåº¦', 'success', `é«˜é€ŸåˆæœŸåŒ–: ${stats.initTime.toFixed(2)}ms`);
                } else {
                    addResult('performance', 'åˆæœŸåŒ–é€Ÿåº¦', 'warning', `åˆæœŸåŒ–æ™‚é–“: ${stats.initTime.toFixed(2)}ms`);
                }
                
                // ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ–ç¢ºèª
                const maxSounds = audioSystem.mobileOptimizations.maxConcurrentSounds;
                if (maxSounds <= 6) {
                    addResult('performance', 'ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ–', 'success', `åŒæ™‚å†ç”Ÿåˆ¶é™: ${maxSounds}éŸ³`);
                } else {
                    addResult('performance', 'ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ–', 'warning', `åŒæ™‚å†ç”Ÿæ•°å¤š: ${maxSounds}éŸ³`);
                }
                
                // ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãƒ†ã‚¹ãƒˆï¼ˆåŠ¹æœéŸ³æ•°ï¼‰
                const soundCount = Object.keys(audioSystem.sounds).length;
                if (soundCount === 6) {
                    addResult('performance', 'ãƒ¡ãƒ¢ãƒªåŠ¹ç‡', 'success', `åŠ¹æœéŸ³ã®ã¿6å€‹: æœ€é©åŒ–æ¸ˆã¿`);
                } else {
                    addResult('performance', 'ãƒ¡ãƒ¢ãƒªåŠ¹ç‡', 'warning', `åŠ¹æœéŸ³æ•°: ${soundCount}å€‹`);
                }
                
                // éŸ³éŸ¿å†ç”Ÿãƒ†ã‚¹ãƒˆ
                let soundTestPassed = 0;
                const soundTests = ['shoot', 'pickup', 'levelUp'];
                
                for (const soundType of soundTests) {
                    try {
                        audioSystem.sounds[soundType]();
                        soundTestPassed++;
                    } catch (error) {
                        console.warn(`Sound test failed: ${soundType}`, error);
                    }
                }
                
                if (soundTestPassed === soundTests.length) {
                    addResult('performance', 'éŸ³éŸ¿å†ç”Ÿ', 'success', `å…¨${soundTestPassed}åŠ¹æœéŸ³å†ç”ŸæˆåŠŸ`);
                } else {
                    addResult('performance', 'éŸ³éŸ¿å†ç”Ÿ', 'warning', `${soundTestPassed}/${soundTests.length}åŠ¹æœéŸ³å†ç”ŸæˆåŠŸ`);
                }
                
            } catch (error) {
                addResult('performance', 'ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ', 'error', `ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
            
            updateSummary();
        }
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã¨ã—ã¦å…¬é–‹
        window.runSystemTests = runSystemTests;
        window.runAudioTests = runAudioTests;
        window.runBGMDeletionTests = runBGMDeletionTests;
        window.runPerformanceTests = runPerformanceTests;
        
        console.log('ğŸ”¥ æœ€çµ‚çµ±åˆãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸æº–å‚™å®Œäº†');
        console.log('å„ãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ç·åˆæ¤œè¨¼ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„');
    </script>
</body>
</html>