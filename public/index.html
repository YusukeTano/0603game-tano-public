<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ã‚¾ãƒ³ãƒ“ã‚µãƒã‚¤ãƒãƒ¼ - 2Dã‚µãƒã‚¤ãƒãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°</title>
    <link rel="stylesheet" href="style.css">
    
    <!-- Tone.js CDN (æœ€æ–°ç‰ˆã§AudioWorkletå¯¾å¿œ) -->
    <script src="https://cdn.jsdelivr.net/npm/tone@latest/build/Tone.js"></script>
    
    <!-- Debug config (before game script) -->
    <script src="debug-config.js"></script>
</head>
<body>
    <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ -->
    <div id="loading-screen">
        <div class="loading-content">
            <h1>ã‚¾ãƒ³ãƒ“ã‚µãƒã‚¤ãƒãƒ¼</h1>
            <div class="loading-bar">
                <div class="loading-fill" id="loading-fill"></div>
            </div>
            <p id="loading-text">ã‚²ãƒ¼ãƒ ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
        </div>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
    <div id="main-menu" class="screen hidden">
        <div class="menu-content">
            <h1 class="game-title">ã‚¾ãƒ³ãƒ“ã‚µãƒã‚¤ãƒãƒ¼</h1>
            <p class="game-subtitle">æ„ŸæŸ“è€…ã®ç¾¤ã‚Œã‹ã‚‰ç”Ÿãæ®‹ã‚Œ</p>
            
            <div class="menu-buttons">
                <button id="start-game-btn" class="menu-btn primary">ã‚²ãƒ¼ãƒ é–‹å§‹</button>
                <button id="instructions-btn" class="menu-btn">æ“ä½œæ–¹æ³•</button>
                <button id="settings-btn" class="menu-btn">è¨­å®š</button>
            </div>
            
            <!-- æ“ä½œèª¬æ˜ã‚¿ãƒ– -->
            <div class="control-tabs">
                <input type="radio" name="control-tab" id="pc-tab" class="tab-radio" checked>
                <input type="radio" name="control-tab" id="mobile-tab" class="tab-radio">
                
                <div class="tab-labels">
                    <label for="pc-tab" class="tab-label pc-label">
                        <span class="tab-icon">ğŸ’»</span>
                        <span class="tab-text">PC</span>
                    </label>
                    <label for="mobile-tab" class="tab-label mobile-label">
                        <span class="tab-icon">ğŸ“±</span>
                        <span class="tab-text">ã‚¹ãƒãƒ›</span>
                    </label>
                </div>
                
                <div class="tab-contents">
                    <div class="tab-content pc-content">
                        <div class="control-item">
                            <span class="control-key">âŒ¨ï¸ WASD</span>
                            <span class="control-desc">ç§»å‹•</span>
                        </div>
                        <div class="control-item">
                            <span class="control-key">ğŸ–±ï¸ ãƒã‚¦ã‚¹</span>
                            <span class="control-desc">ç…§æº–ãƒ»å°„æ’ƒ</span>
                        </div>
                        <div class="control-item">
                            <span class="control-key">Esc</span>
                            <span class="control-desc">ãƒãƒ¼ã‚º</span>
                        </div>
                    </div>
                    <div class="tab-content mobile-content">
                        <div class="control-item">
                            <span class="control-key">ğŸ•¹ï¸ å·¦ã‚¹ãƒ†ã‚£ãƒƒã‚¯</span>
                            <span class="control-desc">ç§»å‹•</span>
                        </div>
                        <div class="control-item">
                            <span class="control-key">ğŸ¯ å³ã‚¹ãƒ†ã‚£ãƒƒã‚¯</span>
                            <span class="control-desc">ç…§æº–ãƒ»å°„æ’ƒ</span>
                        </div>
                        <div class="control-note">
                            <span class="note-icon">â†”ï¸â†•ï¸</span>
                            <span>ç¸¦æ¨ªç”»é¢å¯¾å¿œ</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="high-score">
                <p>æœ€é«˜è¨˜éŒ²: <span id="high-score-display">0</span>ç‚¹</p>
            </div>
        </div>
    </div>

    <!-- ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é¸æŠç”»é¢ -->
    <div id="character-select-screen" class="screen hidden">
        <div class="character-select-content">
            <h2 class="select-title">ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’é¸æŠ</h2>
            
            <div class="characters-grid">
                <!-- ãƒ¬ã‚¤ï¼ˆæ—¢å­˜ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ï¼‰ -->
                <div class="character-card" data-character="ray">
                    <div class="character-preview">
                        <div class="character-visual ray-visual">
                            <div class="ray-ship">
                                <div class="ship-body"></div>
                                <div class="ship-cockpit"></div>
                                <div class="ship-wings"></div>
                                <div class="ship-engine"></div>
                            </div>
                        </div>
                    </div>
                    <div class="character-info">
                        <h3 class="character-name">ãƒ¬ã‚¤</h3>
                        <p class="character-description">åœ°çƒã®å¹³å’Œã‚’å®ˆã‚‹ã®ãŒä»•äº‹</p>
                        <div class="character-features">
                            <span class="feature-tag standard">æ¨™æº–æ“ä½œ</span>
                            <span class="feature-tag balanced">ãƒãƒ©ãƒ³ã‚¹å‹</span>
                        </div>
                    </div>
                </div>

                <!-- ãƒ«ãƒŠï¼ˆåˆå¿ƒè€…å‘ã‘ï¼‰ -->
                <div class="character-card" data-character="luna">
                    <div class="character-preview">
                        <div class="character-visual luna-visual">
                            <div class="luna-body">
                                <div class="luna-circle"></div>
                                <div class="luna-satellite-heart heart-1"></div>
                                <div class="luna-satellite-heart heart-2"></div>
                                <div class="luna-satellite-heart heart-3"></div>
                                <div class="luna-sparkle sparkle-1"></div>
                                <div class="luna-sparkle sparkle-2"></div>
                                <div class="luna-sparkle sparkle-3"></div>
                                <div class="luna-sparkle sparkle-4"></div>
                            </div>
                        </div>
                    </div>
                    <div class="character-info">
                        <h3 class="character-name">ãƒ«ãƒŠ</h3>
                        <p class="character-description">åˆå¿ƒè€…ç”¨ã‚­ãƒ£ãƒ©ã€ãƒã‚¦ã‚¹ã§æ“ä½œ</p>
                        <div class="character-features">
                            <span class="feature-tag beginner">åˆå¿ƒè€…å‘ã‘</span>
                            <span class="feature-tag auto">ã‚ªãƒ¼ãƒˆã‚¨ã‚¤ãƒ </span>
                        </div>
                    </div>
                </div>

                <!-- ã‚ªãƒ¼ãƒ©ãƒ ï¼ˆé‹ç‰¹åŒ–ï¼‰ -->
                <div class="character-card" data-character="aurum">
                    <div class="character-preview">
                        <div class="character-visual aurum-visual">
                            <div class="aurum-body">
                                <div class="aurum-aura outer-aura"></div>
                                <div class="aurum-aura inner-aura"></div>
                                <div class="aurum-hexagon"></div>
                                <div class="aurum-particle particle-1"></div>
                                <div class="aurum-particle particle-2"></div>
                                <div class="aurum-particle particle-3"></div>
                                <div class="aurum-particle particle-4"></div>
                                <div class="aurum-particle particle-5"></div>
                                <div class="aurum-particle particle-6"></div>
                                <div class="aurum-particle particle-7"></div>
                                <div class="aurum-particle particle-8"></div>
                            </div>
                        </div>
                    </div>
                    <div class="character-info">
                        <h3 class="character-name">ã‚ªãƒ¼ãƒ©ãƒ </h3>
                        <p class="character-description">ãƒ¬ã‚¢æ­¦å™¨ã‚’æ‹¾ã„ã‚„ã™ã„</p>
                        <div class="character-features">
                            <span class="feature-tag luck">é‹ç‰¹åŒ–</span>
                            <span class="feature-tag rare">ãƒ¬ã‚¢é‡è¦–</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="select-buttons">
                <button id="character-back-btn" class="select-btn secondary">æˆ»ã‚‹</button>
                <button id="confirm-character-btn" class="select-btn primary" disabled>ã‚²ãƒ¼ãƒ é–‹å§‹</button>
            </div>
        </div>
    </div>

    <!-- æ“ä½œèª¬æ˜ç”»é¢ -->
    <div id="instructions-screen" class="screen hidden">
        <div class="instructions-content">
            <h2>æ“ä½œæ–¹æ³•</h2>
            
            <div class="controls-grid">
                <div class="control-section">
                    <h3>PCæ“ä½œ</h3>
                    <div class="control-item">
                        <span class="key">WASD</span>
                        <span class="desc">ç§»å‹•</span>
                    </div>
                    <div class="control-item">
                        <span class="key">ãƒã‚¦ã‚¹</span>
                        <span class="desc">ç…§æº–ãƒ»å°„æ’ƒ</span>
                    </div>
                </div>
                
                <div class="control-section">
                    <h3>ã‚¹ãƒãƒ›æ“ä½œ</h3>
                    <div class="control-item">
                        <span class="key">å·¦ã‚¹ãƒ†ã‚£ãƒƒã‚¯</span>
                        <span class="desc">ç§»å‹•</span>
                    </div>
                    <div class="control-item">
                        <span class="key">å³ã‚¹ãƒ†ã‚£ãƒƒã‚¯</span>
                        <span class="desc">ç…§æº–</span>
                    </div>
                    <div class="control-item">
                        <span class="key">å°„æ’ƒãƒœã‚¿ãƒ³</span>
                        <span class="desc">å°„æ’ƒ</span>
                    </div>
                </div>
            </div>
            
            <div class="game-tips">
                <h3>ã‚²ãƒ¼ãƒ ã®ã‚³ãƒ„</h3>
                <ul>
                    <li>æ•µã‚’å€’ã™ã¨çµŒé¨“å€¤ã¨ã‚¢ã‚¤ãƒ†ãƒ ã‚’ç²å¾—</li>
                    <li>ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ã§èƒ½åŠ›å‘ä¸Š</li>
                    <li>ğŸŸ¢ ç·‘ã®ã‚¢ã‚¤ãƒ†ãƒ ï¼šæœ€å¤§ä½“åŠ›å¢—åŠ  (+10 HP)</li>
                    <li>ğŸ”µ é’ã®ã‚¢ã‚¤ãƒ†ãƒ ï¼šãƒ€ãƒƒã‚·ãƒ¥åŠ¹æœ (5ç§’é–“)</li>
                    <li>ğŸŸ£ ãƒ”ãƒ³ã‚¯ã®ã‚¢ã‚¤ãƒ†ãƒ ï¼šç§»å‹•é€Ÿåº¦æ°¸ç¶šå‘ä¸Š</li>
                    <li>ğŸŸ  ã‚ªãƒ¬ãƒ³ã‚¸ã®ã‚¢ã‚¤ãƒ†ãƒ ï¼šå¼¾è–¬è£œå…… (å³ã‚¯ãƒªãƒƒã‚¯æ­¦å™¨)</li>
                    <li>æ™‚é–“ãŒçµŒã¤ã»ã©æ•µãŒå¼·ããªã‚‹</li>
                </ul>
            </div>
            
            <button id="back-to-menu-btn" class="menu-btn">æˆ»ã‚‹</button>
        </div>
    </div>

    <!-- ã‚²ãƒ¼ãƒ ç”»é¢ -->
    <div id="game-screen" class="screen hidden">
        <canvas id="game-canvas"></canvas>
        
        <!-- PCç”¨UI -->
        <div id="pc-ui" class="game-ui">
            <div class="top-hud">
                <div class="stat-bar">
                    <div class="stat-item">
                        <span class="label">ä½“åŠ›</span>
                        <span class="health-display" id="health-value">100</span>
                    </div>
                    
                    <div class="stat-item">
                        <span class="label">çµŒé¨“å€¤</span>
                        <div class="bar exp-bar">
                            <div class="fill" id="exp-fill"></div>
                        </div>
                        <span class="value">Lv.<span id="level-value">1</span></span>
                    </div>
                </div>
                
                <div class="info-panel">
                    <div class="info-item">
                        <span class="label">ã‚¹ã‚³ã‚¢</span>
                        <span class="value" id="score-value">0</span>
                    </div>
                    <div class="info-item">
                        <span class="label">ã‚¦ã‚§ãƒ¼ãƒ–</span>
                        <span class="value" id="wave-value">1</span>
                    </div>
                    <div class="info-item stage-display">
                        <span class="label">ã‚¹ãƒ†ãƒ¼ã‚¸</span>
                        <span class="value" id="stage-value">1-1</span>
                        <div class="stage-progress">
                            <div class="stage-progress-bar" id="stage-progress-bar"></div>
                        </div>
                    </div>
                    <div class="info-item">
                        <span class="label">ã‚³ãƒ³ãƒœ</span>
                        <span class="value" id="combo-value">0</span>
                    </div>
                    <div class="info-item">
                        <span class="label">ç”Ÿå­˜æ™‚é–“</span>
                        <span class="value" id="time-value">00:00</span>
                    </div>
                    <div class="info-item">
                        <span class="label">æç”»å“è³ª</span>
                        <span class="value" id="quality-value">é«˜</span>
                    </div>
                </div>
            </div>
            
            <!-- ã‚¹ã‚­ãƒ«ãƒ¬ãƒ™ãƒ«è¡¨ç¤º -->
            <div class="skill-levels-display" id="skill-levels-display">
                <div class="skill-item" id="skill-damage">æ”»æ’ƒ <span class="skill-level">Lv.0</span></div>
                <div class="skill-item" id="skill-fireRate">é€£å°„ <span class="skill-level">Lv.0</span></div>
                <div class="skill-item" id="skill-bulletSize">å¼¾ã‚µ <span class="skill-level">Lv.0</span></div>
                <div class="skill-item" id="skill-piercing">è²«é€š <span class="skill-level">Lv.0</span></div>
                <div class="skill-item" id="skill-multiShot">ãƒãƒ« <span class="skill-level">Lv.0</span></div>
                <div class="skill-item" id="skill-bounce">åå°„ <span class="skill-level">Lv.0</span></div>
                <div class="skill-item" id="skill-homing">è¿½å°¾ <span class="skill-level">Lv.0</span></div>
                <div class="skill-item" id="skill-range">å°„ç¨‹ <span class="skill-level">Lv.0</span></div>
                <div class="skill-item" id="skill-itemAttraction">å¸å¼• <span class="skill-level">Lv.0</span></div>
                <div class="skill-item" id="skill-luck">é‹ <span class="skill-level">Lv.0</span></div>
            </div>
            
            <div class="bottom-hud">
                <div class="weapon-info">
                    <div class="weapon-name" id="weapon-name">ãƒ—ãƒ©ã‚ºãƒãƒ©ã‚¤ãƒ•ãƒ«</div>
                    <div class="ammo-count">
                        <span id="current-ammo">âˆ</span> / <span id="total-ammo">âˆ</span>
                    </div>
                </div>
                
                <!-- ã‚»ã‚«ãƒ³ãƒ€ãƒªæ­¦å™¨æƒ…å ± -->
                <div class="secondary-weapon-info" id="secondary-weapon-info">
                    <div class="secondary-weapon-name" id="secondary-weapon-name">æ³¢å‹•æ”»æ’ƒ</div>
                    <div class="secondary-ammo-count">
                        <span id="secondary-current-ammo">3</span> / <span id="secondary-total-ammo">12</span>
                    </div>
                    <div class="secondary-hint">å³ã‚¯ãƒªãƒƒã‚¯</div>
                </div>
                
                <div class="crosshair"></div>
                
                <!-- WASDæ“ä½œè¡¨ç¤º -->
                <div class="wasd-display" id="wasd-display">
                    <div class="wasd-grid">
                        <div class="wasd-key wasd-w" id="wasd-w">W</div>
                        <div class="wasd-key wasd-a" id="wasd-a">A</div>
                        <div class="wasd-center">
                            <div class="wasd-arrows">
                                <div class="wasd-arrow up">â†‘</div>
                                <div class="wasd-arrow down">â†“</div>
                                <div class="wasd-arrow left">â†</div>
                                <div class="wasd-arrow right">â†’</div>
                            </div>
                        </div>
                        <div class="wasd-key wasd-d" id="wasd-d">D</div>
                        <div class="wasd-key wasd-s" id="wasd-s">S</div>
                    </div>
                    <div class="wasd-labels">
                        <span>ç§»å‹•</span>
                    </div>
                </div>
                
                <!-- ãƒãƒ¼ã‚ºãƒœã‚¿ãƒ³ -->
                <div class="control-buttons">
                    <div class="pause-btn" id="pause-btn">â¸ï¸</div>
                </div>
                
                <!-- ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« -->
                <div class="debug-controls" id="debug-controls">
                    <div class="debug-toggle-btn" id="debug-toggle">ğŸ”§</div>
                    <div class="debug-panel" id="debug-panel" style="display: none;">
                        <div class="debug-title">ãƒ‡ãƒãƒƒã‚°åˆ¶å¾¡</div>
                        <button class="debug-btn production-mode" onclick="debugProduction()">ğŸš€ ãƒ­ã‚°OFF</button>
                        <button class="debug-btn development-mode" onclick="debugDevelopment()">ğŸ”§ ãƒ­ã‚°ON</button>
                        <button class="debug-btn clear-console" onclick="debugClear()">ğŸ§¹ ã‚¯ãƒªã‚¢</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ã‚¹ãƒãƒ›ç”¨UI -->
        <div id="mobile-ui" class="game-ui hidden">
            <div class="mobile-top-hud">
                <!-- ãƒ¢ãƒã‚¤ãƒ«ç”¨ã‚¹ã‚­ãƒ«ãƒ¬ãƒ™ãƒ«è¡¨ç¤º -->
                <div class="mobile-skill-levels" id="mobile-skill-levels">
                    <div class="mobile-skill-row">
                        <div class="mobile-skill" id="mobile-skill-damage">æ”»æ’ƒ<span>Lv.0</span></div>
                        <div class="mobile-skill" id="mobile-skill-fireRate">é€£å°„<span>Lv.0</span></div>
                        <div class="mobile-skill" id="mobile-skill-bulletSize">å¼¾ã‚µ<span>Lv.0</span></div>
                        <div class="mobile-skill" id="mobile-skill-piercing">è²«é€š<span>Lv.0</span></div>
                        <div class="mobile-skill" id="mobile-skill-multiShot">ãƒãƒ«<span>Lv.0</span></div>
                    </div>
                    <div class="mobile-skill-row">
                        <div class="mobile-skill" id="mobile-skill-bounce">åå°„<span>Lv.0</span></div>
                        <div class="mobile-skill" id="mobile-skill-homing">è¿½å°¾<span>Lv.0</span></div>
                        <div class="mobile-skill" id="mobile-skill-range">å°„ç¨‹<span>Lv.0</span></div>
                        <div class="mobile-skill" id="mobile-skill-itemAttraction">å¸å¼•<span>Lv.0</span></div>
                        <div class="mobile-skill" id="mobile-skill-luck">é‹<span>Lv.0</span></div>
                    </div>
                </div>
                
                <div class="mobile-stat-bars">
                    <div class="mobile-bar">
                        <span class="mobile-label">HP</span>
                        <span class="health-display mobile-health-display" id="mobile-health-value">100</span>
                    </div>
                    <div class="mobile-bar">
                        <span class="mobile-label">EXP</span>
                        <div class="bar exp-bar">
                            <div class="fill" id="mobile-exp-fill"></div>
                        </div>
                    </div>
                </div>
                
                <div class="mobile-info">
                    <div class="mobile-row">
                        <div class="mobile-score">ã‚¹ã‚³ã‚¢: <span id="mobile-score">0</span></div>
                        <div class="mobile-level">Lv.<span id="mobile-level">1</span></div>
                    </div>
                    <div class="mobile-row">
                        <div class="mobile-combo">ã‚³ãƒ³ãƒœ: <span id="mobile-combo-value">0</span></div>
                        <div class="mobile-quality">å“è³ª: <span id="mobile-quality-value">é«˜</span></div>
                    </div>
                </div>
            </div>
            
            <!-- Wave Progress ä¸­é–“ã‚¨ãƒªã‚¢ï¼ˆãƒ¢ãƒã‚¤ãƒ«å°‚ç”¨ï¼‰ -->
            <div id="mobile-wave-middle-area" class="mobile-wave-middle-area hidden">
                <div class="wave-progress-middle">
                    <div class="wave-info-row">
                        <span class="wave-number">Wave <span id="middle-wave-value">1</span>/999</span>
                    </div>
                    <div class="enemy-info-row">
                        <span class="enemy-count">æ•µ: <span id="middle-enemies-remaining">0</span>/<span id="middle-enemies-total">0</span></span>
                    </div>
                </div>
            </div>
            
            <div class="mobile-controls">
                <!-- ä»®æƒ³ã‚¹ãƒ†ã‚£ãƒƒã‚¯ -->
                <div class="virtual-sticks">
                    <div id="move-stick" class="virtual-stick left-stick">
                        <div class="stick-base">
                            <div class="stick-knob" id="move-knob"></div>
                        </div>
                    </div>
                    
                    <div id="aim-stick" class="virtual-stick right-stick">
                        <div class="stick-base">
                            <div class="stick-knob" id="aim-knob"></div>
                        </div>
                    </div>
                </div>

                <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
                <div class="action-buttons">
                    <button class="action-btn pause-btn" id="mobile-pause-btn">â¸ï¸</button>
                </div>
                
                <!-- å¼¾è–¬è¡¨ç¤º -->
                <div class="mobile-ammo">
                    <div class="mobile-primary-ammo">
                        <span id="mobile-current-ammo">âˆ</span> / <span id="mobile-total-ammo">âˆ</span>
                    </div>
                    <div class="mobile-secondary-ammo" id="mobile-secondary-ammo">
                        æ³¢å‹•æ”»æ’ƒ: <span id="mobile-secondary-current">0</span>/<span id="mobile-secondary-total">10</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ç”»é¢ -->
        <div id="levelup-modal" class="modal hidden">
            <div class="modal-content">
                <h3>ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼</h3>
                <p>èƒ½åŠ›ã‚’é¸æŠã—ã¦ãã ã•ã„</p>
                <div class="upgrade-options" id="upgrade-options">
                    <!-- JavaScript ã§å‹•çš„ç”Ÿæˆ -->
                </div>
            </div>
        </div>
        
        <!-- ãƒãƒ¼ã‚ºãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
        <div id="pause-modal" class="modal hidden">
            <div class="modal-content">
                <h3>ãƒãƒ¼ã‚º</h3>
                <div class="pause-buttons">
                    <button id="resume-btn" class="menu-btn">å†é–‹</button>
                    <button id="restart-btn" class="menu-btn">ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ</button>
                    <button id="quit-btn" class="menu-btn">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>
                </div>
            </div>
        </div>
        
    </div>

    <!-- è¨­å®šç”»é¢ -->
    <div id="settings-modal" class="modal hidden">
        <div class="modal-content settings-content">
            <div class="settings-header">
                <h3>è¨­å®š</h3>
                <button id="close-settings-btn" class="close-btn">Ã—</button>
            </div>
            
            <div class="settings-body">
                <!-- éŸ³é‡è¨­å®š -->
                <div class="settings-section">
                    <h4>éŸ³é‡è¨­å®š</h4>
                    
                    <!-- ãƒã‚¹ã‚¿ãƒ¼éŸ³é‡ -->
                    <div class="volume-control">
                        <div class="volume-label">
                            <span>ãƒã‚¹ã‚¿ãƒ¼éŸ³é‡</span>
                            <span id="master-volume-display" class="volume-display">80%</span>
                        </div>
                        <div class="volume-slider-container">
                            <input type="range" id="master-volume-slider" class="volume-slider" 
                                   min="0" max="100" value="80" step="1">
                            <button id="master-mute-btn" class="mute-btn" aria-label="ãƒŸãƒ¥ãƒ¼ãƒˆ">ğŸ”Š</button>
                        </div>
                    </div>
                    
                    <!-- åŠ¹æœéŸ³éŸ³é‡ -->
                    <div class="volume-control">
                        <div class="volume-label">
                            <span>åŠ¹æœéŸ³éŸ³é‡</span>
                            <span id="sfx-volume-display" class="volume-display">30%</span>
                        </div>
                        <div class="volume-slider-container">
                            <input type="range" id="sfx-volume-slider" class="volume-slider" 
                                   min="0" max="100" value="30" step="1">
                            <button id="sfx-mute-btn" class="mute-btn" aria-label="ãƒŸãƒ¥ãƒ¼ãƒˆ">ğŸ”Š</button>
                        </div>
                    </div>
                </div>
                
                <!-- ãƒ—ãƒªã‚»ãƒƒãƒˆ -->
                <div class="settings-section">
                    <h4>éŸ³é‡ãƒ—ãƒªã‚»ãƒƒãƒˆ</h4>
                    <div class="preset-buttons">
                        <button id="preset-quiet" class="preset-btn">é™ã‹</button>
                        <button id="preset-normal" class="preset-btn">æ¨™æº–</button>
                        <button id="preset-loud" class="preset-btn">å¤§éŸ³é‡</button>
                    </div>
                </div>
                
                <!-- ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ -->
                <div class="settings-section">
                    <button id="reset-settings-btn" class="menu-btn secondary">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ç”»é¢ -->
    <div id="gameover-screen" class="screen hidden">
        <div class="gameover-content">
            <h2>ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼</h2>
            <p class="death-message" id="death-message">æ„ŸæŸ“è€…ã«å€’ã•ã‚Œã¾ã—ãŸ...</p>
            
            <div class="final-stats">
                <div class="stat-row">
                    <span>æœ€çµ‚ã‚¹ã‚³ã‚¢</span>
                    <span id="final-score">0</span>
                </div>
                <div class="stat-row">
                    <span>ç”Ÿå­˜æ™‚é–“</span>
                    <span id="final-time">00:00</span>
                </div>
                <div class="stat-row">
                    <span>åˆ°é”ãƒ¬ãƒ™ãƒ«</span>
                    <span id="final-level">1</span>
                </div>
                <div class="stat-row">
                    <span>æ’ƒç ´æ•°</span>
                    <span id="final-kills">0</span>
                </div>
                <div class="stat-row">
                    <span>æœ€å¤§ã‚³ãƒ³ãƒœ</span>
                    <span id="final-combo">0</span>
                </div>
            </div>
            
            <div class="new-record hidden" id="new-record">
                <p class="record-text">ğŸ‰ æ–°è¨˜éŒ²é”æˆï¼ ğŸ‰</p>
            </div>
            
            <div class="gameover-buttons">
                <button id="play-again-btn" class="menu-btn primary">ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤</button>
                <button id="main-menu-btn" class="menu-btn">ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼</button>
            </div>
        </div>
    </div>

    <script>
        // iOS Safariç”¨å‹•çš„viewporté«˜ã•èª¿æ•´
        function setDynamicVH() {
            // å®Ÿéš›ã®viewporté«˜ã•ã‚’å–å¾—
            let vh = window.innerHeight * 0.01;
            
            // CSSå¤‰æ•°ã¨ã—ã¦è¨­å®š
            document.documentElement.style.setProperty('--vh', `${vh}px`);
            document.documentElement.style.setProperty('--dynamic-vh', `${vh}px`);
            
            // iOS Safariç‰¹æœ‰ã®å‡¦ç†
            if (/iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream) {
                // visualViewportãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹å ´åˆï¼ˆiOS 13+ï¼‰
                if (window.visualViewport) {
                    const updateViewport = () => {
                        let vh = window.visualViewport.height * 0.01;
                        document.documentElement.style.setProperty('--vh', `${vh}px`);
                        document.documentElement.style.setProperty('--dynamic-vh', `${vh}px`);
                    };
                    
                    window.visualViewport.addEventListener('resize', updateViewport);
                    window.visualViewport.addEventListener('scroll', updateViewport);
                    updateViewport();
                }
                
                // Safariã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼å¤‰åŒ–ã‚’æ¤œå‡º
                let initialHeight = window.innerHeight;
                let currentHeight = window.innerHeight;
                
                const checkHeight = () => {
                    currentHeight = window.innerHeight;
                    if (Math.abs(currentHeight - initialHeight) > 50) {
                        let vh = currentHeight * 0.01;
                        document.documentElement.style.setProperty('--vh', `${vh}px`);
                        document.documentElement.style.setProperty('--dynamic-vh', `${vh}px`);
                    }
                };
                
                // å®šæœŸçš„ã«ãƒã‚§ãƒƒã‚¯ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’è€ƒæ…®ã—ã¦500msé–“éš”ï¼‰
                setInterval(checkHeight, 500);
            }
        }
        
        // åˆæœŸè¨­å®š
        setDynamicVH();
        
        // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºæ™‚ã®å‡¦ç†
        window.addEventListener('resize', setDynamicVH);
        window.addEventListener('orientationchange', () => {
            // ã‚ªãƒªã‚¨ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å¤‰æ›´æ™‚ã¯å°‘ã—é…ã‚‰ã›ã¦å®Ÿè¡Œ
            setTimeout(setDynamicVH, 100);
        });
        
        // Safariã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼è¡¨ç¤º/éè¡¨ç¤ºæ¤œå‡º
        let lastHeight = window.innerHeight;
        window.addEventListener('scroll', () => {
            if (Math.abs(window.innerHeight - lastHeight) > 50) {
                setDynamicVH();
                lastHeight = window.innerHeight;
            }
        });
        
        // iOS Safariç‰¹æœ‰ã®å•é¡Œå¯¾å¿œ: ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰å®Œäº†å¾Œã«å†èª¿æ•´
        window.addEventListener('load', () => {
            setTimeout(setDynamicVH, 300);
        });
        
        // Safe Area insetå€¤ã‚’ãƒ­ã‚°å‡ºåŠ›ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
        if (window.CSS && CSS.supports('padding', 'env(safe-area-inset-top)')) {
            console.log('Safe Area Insets supported');
            
            // Safe Areaå€¤ã‚’ç›£è¦–ï¼ˆé–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ç”¨ï¼‰
            const logSafeAreas = () => {
                const computedStyle = getComputedStyle(document.documentElement);
                console.log({
                    'safe-area-inset-top': computedStyle.getPropertyValue('--safe-area-inset-top'),
                    'safe-area-inset-bottom': computedStyle.getPropertyValue('--safe-area-inset-bottom'),
                    'safe-area-inset-left': computedStyle.getPropertyValue('--safe-area-inset-left'),
                    'safe-area-inset-right': computedStyle.getPropertyValue('--safe-area-inset-right'),
                    'viewport-height': window.innerHeight,
                    'visual-viewport-height': window.visualViewport ? window.visualViewport.height : 'not supported'
                });
            };
            
            // é–‹ç™ºæ™‚ã®ã¿å®Ÿè¡Œï¼ˆæœ¬ç•ªã§ã¯å‰Šé™¤å¯èƒ½ï¼‰
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                setTimeout(logSafeAreas, 1000);
            }
        }
    </script>
    <script>
        // ãƒ‡ãƒã‚¤ã‚¹æ¤œå‡ºã¨è‡ªå‹•ã‚¿ãƒ–é¸æŠ
        function initControlTabs() {
            const pcTab = document.getElementById('pc-tab');
            const mobileTab = document.getElementById('mobile-tab');
            
            // ãƒ‡ãƒã‚¤ã‚¹æ¤œå‡º
            function detectDevice() {
                const userAgent = navigator.userAgent.toLowerCase();
                const isMobileUA = /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(userAgent);
                const hasTouchPoints = navigator.maxTouchPoints && navigator.maxTouchPoints > 0;
                const hasTouch = 'ontouchstart' in window || navigator.msMaxTouchPoints > 0;
                const isSmallScreen = window.innerWidth <= 1024;
                
                return isMobileUA || hasTouchPoints || hasTouch || isSmallScreen;
            }
            
            // åˆæœŸã‚¿ãƒ–é¸æŠ
            const isMobile = detectDevice();
            if (isMobile) {
                mobileTab.checked = true;
                pcTab.checked = false;
            } else {
                pcTab.checked = true;
                mobileTab.checked = false;
            }
            
            console.log('ControlTabs: Device detection completed', {
                isMobile: isMobile,
                userAgent: navigator.userAgent,
                maxTouchPoints: navigator.maxTouchPoints,
                screenWidth: window.innerWidth,
                selectedTab: isMobile ? 'mobile' : 'pc'
            });
            
            // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰è¨­å®šã‚’å¾©å…ƒï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ‰‹å‹•é¸æŠã—ãŸå ´åˆï¼‰
            const savedTab = localStorage.getItem('preferred-control-tab');
            if (savedTab === 'pc' || savedTab === 'mobile') {
                if (savedTab === 'pc') {
                    pcTab.checked = true;
                    mobileTab.checked = false;
                } else {
                    mobileTab.checked = true;
                    pcTab.checked = false;
                }
                console.log('ControlTabs: Restored saved preference:', savedTab);
            }
            
            // ã‚¿ãƒ–å¤‰æ›´æ™‚ã®è¨­å®šä¿å­˜
            pcTab.addEventListener('change', () => {
                if (pcTab.checked) {
                    localStorage.setItem('preferred-control-tab', 'pc');
                }
            });
            
            mobileTab.addEventListener('change', () => {
                if (mobileTab.checked) {
                    localStorage.setItem('preferred-control-tab', 'mobile');
                }
            });
        }
        
        // DOMãƒ­ãƒ¼ãƒ‰æ™‚ã«åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', initControlTabs);
        
        // ç”»é¢ã‚µã‚¤ã‚ºå¤‰æ›´æ™‚ã®å†æ¤œå‡ºï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
        window.addEventListener('resize', () => {
            // è‡ªå‹•åˆ‡ã‚Šæ›¿ãˆã‚’ç„¡åŠ¹ã«ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®é¸æŠã‚’å°Šé‡
            // å¿…è¦ã«å¿œã˜ã¦ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã‚’è§£é™¤
            // setTimeout(initControlTabs, 100);
        });
    </script>
    
    <!-- ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«åˆ¶å¾¡ -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const debugToggle = document.getElementById('debug-toggle');
            const debugPanel = document.getElementById('debug-panel');
            
            if (debugToggle && debugPanel) {
                debugToggle.addEventListener('click', function() {
                    const isVisible = debugPanel.style.display !== 'none';
                    debugPanel.style.display = isVisible ? 'none' : 'block';
                    debugToggle.style.transform = isVisible ? 'scale(1)' : 'scale(1.1)';
                });
                
                // ãƒ‘ãƒãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
                document.addEventListener('click', function(event) {
                    const debugControls = document.getElementById('debug-controls');
                    if (debugControls && !debugControls.contains(event.target)) {
                        debugPanel.style.display = 'none';
                        debugToggle.style.transform = 'scale(1)';
                    }
                });
            }
        });
    </script>
    
    <!-- Phase 5æœ¬ç•ªãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ï¼ˆé–‹ç™ºãƒ»ãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰ -->
    <script src="phase5-production-test.js"></script>
    <script type="module" src="js/main.js"></script>
</body>
</html>