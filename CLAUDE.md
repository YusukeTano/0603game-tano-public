# 開発状況
同じブランチで4人で作業してるので、ファイル編集競合が起こる可能性を加味して作業しましょう。

# ゲーム開発TODO（優先度別）

## 完了済み ✅

### **コンボ弾丸色変更システム** (2025-06-16実装完了)
- **実装ファイル**: 
  - `js/utils/combo-color-system.js` (新規作成)
  - `js/systems/weapon-system.js` (修正)
  - `js/systems/render-system.js` (修正)
  - `js/entities/bullet.js` (コンボプロパティ追加)
- **機能詳細**:
  - 3コンボごとに弾丸色が変化（10段階カラーパレット）
  - 30コンボ以上でレインボー効果（時間ベース色変化）
  - コンボレベル別グロー強度調整・弾丸サイズボーナス（最大200%）
  - 全武器タイプ（通常弾・ニューク・スーパーホーミング・スーパーショットガン）に適用
  - 9コンボ以上で特殊エフェクト（オーラリング・火花強化）
- **技術実装**: 
  - Factory Pattern + Strategy Patternで既存アーキテクチャに統合
  - コンボ値は`game.combo.count`で管理（プレイヤーではなくゲーム側）
  - Bulletクラスでレインボー色相の動的更新実装
- **色変化仕様**: 白→黄色→オレンジ→赤→紫→青→水色→緑→ピンク→金色→レインボー
- **修正履歴**: 
  - 初期実装後、弾丸色が変わらない不具合を修正
  - コンボ値参照先を`this.game.player.combo` → `this.game.combo.count`に修正
  - Bulletクラスにコンボ色プロパティを追加（comboColor, comboGlowIntensity等）

### **武器切り替えバグ修正** (2025-06-15)
- ドロップ武器を複数回切り替えた後、通常武器に戻らない問題を修正
- `previousWeapon`プロパティで通常武器への参照を保持
- 修正ファイル: `js/systems/weapon-system.js`

### **ドロップ武器弾サイズ統一** (2025-06-15)  
- ニューク・スーパーホーミング武器でプレイヤーの弾サイズスキルが反映されない問題を修正
- 全ドロップ武器でプレイヤーの`bulletSizeMultiplier`が適用されるよう統一
- 修正ファイル: `js/systems/weapon-system.js`

### **パイロットイン分身システム削除** (2025-06-15)
- **PlayerClone.jsファイル削除**: `/public/js/entities/player-clone.js`を完全削除
- **Player.js修正**: 分身関連プロパティとメソッドを削除
  - `this.pilotInChance`, `this.clones`プロパティ削除
  - `manageClones()`, `createClones()`, `updateClones()`メソッド削除
  - 分身関連の初期化・リセット処理削除
- **WeaponSystem.js修正**: 分身射撃処理を削除
  - `_handlePilotInShooting()`メソッド削除
- **RenderSystem.js修正**: 分身描画処理を削除
  - `renderPlayerClones()`, `_renderSingleClone()`, `_renderCloneAura()`, `_renderCloneBody()`メソッド削除
- **LevelSystem.js修正**: パイロットインスキル削除
  - パイロットイン I/II/III スキル定義削除
- **影響**: 約400行のコード削除、パフォーマンス向上、システム複雑性軽減

### **音量調整システム** (2025-06-16実装完了)
- **実装ファイル**:
  - `js/systems/settings-system.js` (新規作成)
  - `js/systems/audio-system.js` (音量制御機能追加)
  - `index.html` (設定モーダル画面追加)
  - `style.css` (設定画面スタイル追加)
  - `game.js` (SettingsSystemの統合)
- **機能詳細**:
  - マスター音量/BGM音量/効果音音量の3段階個別調整（0-100%）
  - ミュートボタン機能（🔊/🔇アイコン切り替え）
  - 音量プリセット：「静か」(40/20/30%)「標準」(80/60/70%)「大音量」(100/90/100%)
  - リアルタイム音量反映・効果音プレビュー機能
  - localStorage設定保存・自動復元
  - レスポンシブデザイン（PC/モバイル両対応）
- **技術実装**: 
  - `getCalculatedVolume()`メソッドで音量計算統一
  - 全BGM・効果音に音量設定を反映
  - 設定画面のポーズ連携機能

### **スマホ横画面スキル選択UI修正** (2025-06-16実装完了)
- **実装ファイル**: `style.css` (横画面専用メディアクエリ追加)
- **修正内容**: 
  - 横画面時のスキル選択はみ出し問題を解決
  - 3カラム横並びレイアウト実装（スクロール完全排除）
  - モーダル幅を800pxに拡張、高さを85vhに制限
- **技術実装**:
  - `@media screen and (orientation: landscape) and (max-height: 500px)` 専用スタイル
  - `.upgrade-options`: `flex-direction: row` で横並び配置
  - `.upgrade-option`: `flex: 1` + `max-width: 32%` で等幅3カラム
  - フォントサイズ最適化（スキル名0.9rem、説明0.75rem、レアリティ0.65rem）
- **効果**: iPhone等の横画面でスクロールなしで3つのスキルを選択可能

## 高優先度 🔴

### BGM・音響システム
- BGMがステージ1とステージ2で変わってない感じする
- ステージの時間が経過によって、テンポとキーが徐々に上がっていく。これも実装されてない感じする
- ~~スーパーホーミングが黄色の線が出るけど要らない~~ ✅ 修正完了 (2025-06-16)
- ~~音量調整機能~~ ✅ 実装完了 (2025-06-16)

### 武器・ゲームプレイシステム
- ショットガンの確率を下げる
- エレメント追加したい
- スキル選択で、アイテム吸引を増やす
- 射程距離増加のアイコンを他と合わせる
- ドロップアイテムの確率がおかしい
- 難易度一括システム
- 敵に影を付けたい

### UI・UX改善
- ~~スマホのスキル選択画面のUIを直す~~ ✅ 修正完了 (2025-06-16)
- ~~スマホの縦画面と横画面のスキル選択時のUI直す~~ ✅ 修正完了 (2025-06-16)
- スキルレベルのUIを追加したい
- スキル数値のUI一覧
- 最初のUIにパソコンならWASD操作、スマホならスティック操作を明示するUIにしたい

### 視覚・表現改善
- 背景を変えたい
- キャラクターを人間が走ってるみたいにしたい

### バグ修正
- 射撃ボタン押しながら、スキル選択になって選択したあとに、通常画面に戻ると射撃ボタン押さなくても弾が出る
- ゲームオーバーになって、もう一回プレイを押せばスーパーマリオが始まる

## 新機能検討 💡

### 新武器アイデア
スーパーホーミングガン、スーパーマルチショット、ショックウェーブガン。の3つが良いと思っています。
それぞれの仕様について提案してください。実装はまだです。

### エレメントシステム案
**案 C：エレメント型（属性ダメと状態異常）**
炎・氷・雷など属性を導入してDoT（継続ダメ）× Crowd Controlの組み合わせを楽しむ方向。

| レア度 | 追加スキル (抜粋) | 効果例 |
|--------|------------------|--------|
| コモン | 火術入門（炎 DoT 3/s 3秒）<br>氷術入門（移速 -10% 2秒）<br>雷術入門（25% スタン 0.3秒） | 基礎属性をばら撒く |
| アンコモン | 火炎旋風（DoT 6/s 3秒、半径↑）<br>氷柱結晶（スロウ 30%、範囲+20%） | 属性を強化 |
| レア | 雷連鎖（スタン 0.5秒、5m 連鎖） | CC を確定させる |
| エピック | 元素共鳴（同一属性 3hit で爆発） | シナジー |
| レジェンダリー | 元素超越（属性を問わず DoT+50%、CC 時間 +50%） | 全ビルド最終目標 |

---

# 開発メモ

## アーキテクチャ情報
- **分身システム削除済み**: PlayerClone関連のコードは全て削除済み
- **武器システム**: WeaponSystem.jsで一元管理、一時武器（ニューク、スーパーホーミング、スーパーショットガン）対応
- **レベルシステム**: LevelSystem.jsでスキル管理、レアリティベースの抽選システム
- **コンボシステム**: ComboColorSystem.jsで弾丸色変化（30コンボ上限、レインボー対応）
- **BGM・音響**: AudioSystem.jsで動的BGM、ステージ別音響効果、3段階音量制御
- **設定システム**: SettingsSystem.jsで音量設定UI管理、localStorage保存・復元
- **UIシステム**: レスポンシブ対応（PC/モバイル/横画面/縦画面）、メディアクエリによる画面別最適化

## 技術的注意点
- ES6モジュール使用、`import/export`文法
- Canvas 2D APIでの描画システム
- モバイル・PC両対応の入力システム
- レスポンシブUI設計

## 削除済みコード概要
- **PlayerClone.js**: 分身エンティティクラス（完全削除）
- **Player.js**: 分身管理ロジック（pilotInChance、clones等削除）
- **WeaponSystem.js**: 分身射撃処理（_handlePilotInShooting削除）
- **RenderSystem.js**: 分身描画処理（renderPlayerClones等削除）
- **LevelSystem.js**: パイロットインスキル定義（I/II/III削除）

## 音量システム実装詳細
- **デフォルト音量**: マスター80%、BGM60%、効果音70%
- **音量計算式**: `最終音量 = マスター音量 × 種別音量 × 基本音量`
- **設定保存キー**: `audioSettings` (localStorage)
- **対応音響**: 全ての効果音とBGMに音量設定が反映
- **UI**: ESCキー・モーダル外クリックで設定画面を閉じる

## スマホUI実装詳細 (2025-06-16)
- **横画面最適化**: `@media screen and (orientation: landscape) and (max-height: 500px)`
- **3カラムレイアウト**: `.upgrade-options`を`flex-direction: row`で横並び化
- **スキルカード**: `flex: 1` + `max-width: 32%`で等幅3分割
- **サイズ調整**: モーダル幅800px、高さ85vh、パディング1rem
- **フォント最適化**: 階層的サイズ調整でタッチ操作性と視認性を両立
- **縦画面保持**: 縦画面時は従来通りの縦並びレイアウトを維持

## スーパーホーミング武器修正詳細 (2025-06-16)
- **修正内容**: 黄色のターゲットライン表示を除去
- **修正ファイル**: `js/systems/render-system.js`
- **修正方法**: `_renderSuperHomingBullet()`内の`_renderTargetLine()`呼び出しをコメントアウト（1401-1403行目）
- **影響**: 視覚的なクリーンアップのみ、ホーミング機能は維持

## コンボ弾丸色システム技術詳細 (2025-06-16)
- **コンボ管理**: game.jsの`this.combo = { count, maxCombo, lastKillTime, comboTimeout }`
- **コンボ増加**: 敵撃破時に`handleEnemyDeath()`で`this.combo.count++`
- **コンボリセット**: 3秒タイムアウトまたはプレイヤーダメージ時
- **弾丸統合**: WeaponSystem → BulletSystem → Bullet クラスの連携
- **描画処理**: RenderSystemで武器別描画メソッドに色情報を適用
- **レインボー更新**: Bulletクラスのupdate()で10秒周期の色相変化

## 既知の問題
- ~~**コンボ弾丸色が変わらない**: コンボ値参照先とBulletプロパティの問題~~ ✅ 修正完了 (2025-06-16)