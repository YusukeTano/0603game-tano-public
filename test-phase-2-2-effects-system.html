<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 2.2 Effects System - åŒ…æ‹¬ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1, h2 {
            color: #00ffff;
            border-bottom: 2px solid #00ffff;
            padding-bottom: 10px;
        }
        
        .test-section {
            background: #2a2a2a;
            border: 1px solid #555;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
        }
        
        .test-controls {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        button {
            background: #0066cc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-family: inherit;
            font-size: 14px;
        }
        
        button:hover {
            background: #0088ff;
        }
        
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        .slider-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }
        
        .slider-control label {
            color: #00ffff;
            width: 120px;
        }
        
        .slider-control input[type="range"] {
            flex: 1;
            max-width: 200px;
        }
        
        .slider-control span {
            color: #00ff00;
            width: 60px;
            text-align: right;
        }
        
        .test-result {
            background: #333;
            border-left: 4px solid #00ff00;
            padding: 15px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .test-result.error {
            border-left-color: #ff0000;
            color: #ff9999;
        }
        
        .test-result.warning {
            border-left-color: #ffaa00;
            color: #ffcc99;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: #333;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #555;
        }
        
        .stat-title {
            color: #00ffff;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .stat-value {
            font-size: 18px;
            color: #00ff00;
        }
        
        .logo {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .logo h1 {
            font-size: 2.5em;
            margin: 0;
            text-shadow: 0 0 10px #00ffff;
        }
        
        .phase-indicator {
            background: linear-gradient(45deg, #0066cc, #00ffff);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .success { color: #00ff00; }
        .error { color: #ff4444; }
        .warning { color: #ffaa00; }
        
        .effect-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .effect-panel {
            background: #2a2a2a;
            border: 1px solid #555;
            padding: 15px;
            border-radius: 8px;
        }
        
        .effect-panel h3 {
            color: #00ffff;
            margin-top: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">
            <h1>ğŸ›ï¸ Phase 2.2: Effects System</h1>
            <div class="phase-indicator">Phase 2.2: éŸ³éŸ¿ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚·ã‚¹ãƒ†ãƒ åŒ…æ‹¬æ¤œè¨¼</div>
        </div>
        
        <!-- 1. ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h2>ğŸš€ 1. ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ</h2>
            <div class="test-controls">
                <button onclick="testEffectsInitialization()">ã‚¨ãƒ•ã‚§ã‚¯ãƒˆåˆæœŸåŒ–</button>
                <button onclick="testBasicEffectsCreation()">åŸºæœ¬ã‚¨ãƒ•ã‚§ã‚¯ãƒˆä½œæˆ</button>
                <button onclick="testAdvancedEffectsCreation()">ã‚¢ãƒ‰ãƒãƒ³ã‚¹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆä½œæˆ</button>
                <button onclick="testEffectChains()">ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãƒã‚§ãƒ¼ãƒ³æ§‹ç¯‰</button>
            </div>
            <div id="init-result" class="test-result"></div>
        </div>
        
        <!-- 2. çµ±åˆéŸ³æ¥½ã‚¨ãƒ³ã‚¸ãƒ³ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h2>ğŸ¼âœ¨ 2. çµ±åˆéŸ³æ¥½ã‚¨ãƒ³ã‚¸ãƒ³ãƒ†ã‚¹ãƒˆ</h2>
            <div class="test-controls">
                <button onclick="testEnhancedEngineInit()">çµ±åˆã‚¨ãƒ³ã‚¸ãƒ³åˆæœŸåŒ–</button>
                <button onclick="testEnhancedBGMPlay()">ã‚¨ãƒ•ã‚§ã‚¯ãƒˆä»˜ãBGMå†ç”Ÿ</button>
                <button onclick="testEffectChainApplication()">æ¥½å™¨ã‚¨ãƒ•ã‚§ã‚¯ãƒˆé©ç”¨</button>
                <button onclick="testGameStateIntegration()">ã‚²ãƒ¼ãƒ çŠ¶æ…‹é€£å‹•</button>
            </div>
            <div id="enhanced-result" class="test-result"></div>
        </div>
        
        <!-- 3. å€‹åˆ¥ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h2>ğŸ›ï¸ 3. å€‹åˆ¥ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãƒ†ã‚¹ãƒˆ</h2>
            <div class="test-controls">
                <button onclick="testReverbEffect()">ãƒªãƒãƒ¼ãƒ–ãƒ†ã‚¹ãƒˆ</button>
                <button onclick="testFilterEffect()">ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ†ã‚¹ãƒˆ</button>
                <button onclick="testDistortionEffect()">ãƒ‡ã‚£ã‚¹ãƒˆãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ</button>
                <button onclick="testCompressorEffect()">ã‚³ãƒ³ãƒ—ãƒ¬ãƒƒã‚µãƒ¼ãƒ†ã‚¹ãƒˆ</button>
                <button onclick="testChorusEffect()">ã‚³ãƒ¼ãƒ©ã‚¹ãƒ†ã‚¹ãƒˆ</button>
                <button onclick="testDelayEffect()">ãƒ‡ã‚£ãƒ¬ã‚¤ãƒ†ã‚¹ãƒˆ</button>
            </div>
            <div id="individual-result" class="test-result"></div>
        </div>
        
        <!-- 4. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¨ãƒ•ã‚§ã‚¯ãƒˆåˆ¶å¾¡ -->
        <div class="test-section">
            <h2>ğŸšï¸ 4. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¨ãƒ•ã‚§ã‚¯ãƒˆåˆ¶å¾¡</h2>
            
            <div class="effect-controls">
                <!-- ãƒªãƒãƒ¼ãƒ–åˆ¶å¾¡ -->
                <div class="effect-panel">
                    <h3>ğŸ›ï¸ ãƒªãƒãƒ¼ãƒ–</h3>
                    <div class="slider-control">
                        <label>å¼·åº¦:</label>
                        <input type="range" id="reverb-intensity" min="0" max="100" value="30" oninput="adjustReverbRealtime(this.value)">
                        <span id="reverb-value">30%</span>
                    </div>
                    <button onclick="testReverbSweep()">ãƒªãƒãƒ¼ãƒ–ã‚¹ã‚¤ãƒ¼ãƒ—</button>
                </div>
                
                <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼åˆ¶å¾¡ -->
                <div class="effect-panel">
                    <h3>ğŸ”Š ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</h3>
                    <div class="slider-control">
                        <label>å‘¨æ³¢æ•°:</label>
                        <input type="range" id="filter-freq" min="100" max="20000" value="5000" oninput="adjustFilterRealtime(this.value)">
                        <span id="filter-value">5000Hz</span>
                    </div>
                    <div class="test-controls">
                        <button onclick="setFilterType('lowpass')">ãƒ­ãƒ¼ãƒ‘ã‚¹</button>
                        <button onclick="setFilterType('highpass')">ãƒã‚¤ãƒ‘ã‚¹</button>
                        <button onclick="setFilterType('bandpass')">ãƒãƒ³ãƒ‰ãƒ‘ã‚¹</button>
                    </div>
                </div>
                
                <!-- ãƒ‡ã‚£ã‚¹ãƒˆãƒ¼ã‚·ãƒ§ãƒ³åˆ¶å¾¡ -->
                <div class="effect-panel">
                    <h3>âš¡ ãƒ‡ã‚£ã‚¹ãƒˆãƒ¼ã‚·ãƒ§ãƒ³</h3>
                    <div class="slider-control">
                        <label>å¼·åº¦:</label>
                        <input type="range" id="distortion-amount" min="0" max="100" value="40" oninput="adjustDistortionRealtime(this.value)">
                        <span id="distortion-value">40%</span>
                    </div>
                    <button onclick="testDistortionSweep()">ãƒ‡ã‚£ã‚¹ãƒˆãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¤ãƒ¼ãƒ—</button>
                </div>
                
                <!-- ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ -->
                <div class="effect-panel">
                    <h3>ğŸ® ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h3>
                    <div class="slider-control">
                        <label>ã‚³ãƒ³ãƒœæ•°:</label>
                        <input type="range" id="game-combo" min="0" max="50" value="0" oninput="updateGameStateRealtime()">
                        <span id="combo-value">0</span>
                    </div>
                    <div class="slider-control">
                        <label>å¼·åº¦:</label>
                        <input type="range" id="game-intensity" min="0" max="200" value="100" oninput="updateGameStateRealtime()">
                        <span id="intensity-value">100%</span>
                    </div>
                    <div class="test-controls">
                        <button onclick="setGameScene('menu')">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</button>
                        <button onclick="setGameScene('battle')">ãƒãƒˆãƒ«</button>
                        <button onclick="setGameScene('boss')">ãƒœã‚¹</button>
                    </div>
                </div>
            </div>
            
            <div id="realtime-result" class="test-result"></div>
        </div>
        
        <!-- 5. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h2>âš¡ 5. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ</h2>
            <div class="test-controls">
                <button onclick="testEffectsLatency()">ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼</button>
                <button onclick="testMemoryUsage()">ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡</button>
                <button onclick="testCPULoad()">CPUè² è·</button>
                <button onclick="testLongRunningEffects()">é•·æ™‚é–“å‹•ä½œ</button>
                <button onclick="runFullPerformanceTest()">å®Œå…¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ</button>
            </div>
            <div id="performance-result" class="test-result"></div>
        </div>
        
        <!-- 6. ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ãƒ»çµ±è¨ˆ -->
        <div class="test-section">
            <h2>ğŸ“Š 6. ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ãƒ»çµ±è¨ˆ</h2>
            <div class="test-controls">
                <button onclick="updateSystemStatus()">çŠ¶æ…‹æ›´æ–°</button>
                <button onclick="clearAllTests()">å…¨ãƒ†ã‚¹ãƒˆã‚¯ãƒªã‚¢</button>
                <button onclick="runFullTestSuite()">å®Œå…¨ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆå®Ÿè¡Œ</button>
                <button onclick="exportTestResults()">ãƒ†ã‚¹ãƒˆçµæœã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-title">ã‚¨ãƒ•ã‚§ã‚¯ãƒˆåˆæœŸåŒ–</div>
                    <div class="stat-value" id="stat-effects-init">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ</div>
                    <div class="stat-value" id="stat-active-effects">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãƒã‚§ãƒ¼ãƒ³</div>
                    <div class="stat-value" id="stat-effect-chains">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">å‡¦ç†ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼</div>
                    <div class="stat-value" id="stat-latency">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡</div>
                    <div class="stat-value" id="stat-memory">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">ã‚¨ãƒ©ãƒ¼æ•°</div>
                    <div class="stat-value" id="stat-errors">-</div>
                </div>
            </div>
            
            <div id="status-result" class="test-result"></div>
        </div>
    </div>

    <!-- Tone.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/tone@latest/build/Tone.js"></script>
    
    <script type="module">
        import { AudioEffectsManager } from './public/js/systems/audio-effects-manager.js';
        import { EnhancedMusicEngine } from './public/js/systems/enhanced-music-engine.js';
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let effectsManager = null;
        let enhancedEngine = null;
        let testResults = [];
        let currentGameState = { combo: 0, intensity: 1.0, scene: 'normal' };
        
        // 1. ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ
        window.testEffectsInitialization = async function() {
            try {
                displayResult('init-result', 'ğŸš€ ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆé–‹å§‹...', 'info');
                
                if (!effectsManager) {
                    effectsManager = new AudioEffectsManager();
                }
                
                const result = await effectsManager.initialize();
                
                if (result.success) {
                    displayResult('init-result', 
                        `âœ… ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–æˆåŠŸ (${result.latency.toFixed(2)}ms)`, 'success');
                } else {
                    displayResult('init-result', 
                        `âŒ ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å¤±æ•—: ${result.error}`, 'error');
                }
                
                updateSystemStatus();
                
            } catch (error) {
                displayResult('init-result', `âŒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        };
        
        window.testBasicEffectsCreation = async function() {
            try {
                displayResult('init-result', 'ğŸ›ï¸ åŸºæœ¬ã‚¨ãƒ•ã‚§ã‚¯ãƒˆä½œæˆãƒ†ã‚¹ãƒˆ...', 'info');
                
                await ensureEffectsManager();
                const status = effectsManager.getEffectsStatus();
                
                const basicEffects = ['reverb', 'filter', 'distortion', 'compressor'];
                const createdEffects = basicEffects.filter(effect => status.effects[effect]);
                
                displayResult('init-result', 
                    `âœ… åŸºæœ¬ã‚¨ãƒ•ã‚§ã‚¯ãƒˆä½œæˆ: ${createdEffects.length}/${basicEffects.length}\n` +
                    `ä½œæˆæ¸ˆã¿: ${createdEffects.join(', ')}`, 
                    createdEffects.length === basicEffects.length ? 'success' : 'warning');
                    
            } catch (error) {
                displayResult('init-result', `âŒ åŸºæœ¬ã‚¨ãƒ•ã‚§ã‚¯ãƒˆä½œæˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        };
        
        window.testAdvancedEffectsCreation = async function() {
            try {
                displayResult('init-result', 'ğŸŒŠ ã‚¢ãƒ‰ãƒãƒ³ã‚¹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆä½œæˆãƒ†ã‚¹ãƒˆ...', 'info');
                
                await ensureEffectsManager();
                const status = effectsManager.getEffectsStatus();
                
                const advancedEffects = ['chorus', 'delay', 'equalizer', 'limiter'];
                const createdEffects = advancedEffects.filter(effect => status.effects[effect]);
                
                displayResult('init-result', 
                    `âœ… ã‚¢ãƒ‰ãƒãƒ³ã‚¹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆä½œæˆ: ${createdEffects.length}/${advancedEffects.length}\n` +
                    `ä½œæˆæ¸ˆã¿: ${createdEffects.join(', ')}`, 
                    createdEffects.length >= 2 ? 'success' : 'warning');
                    
            } catch (error) {
                displayResult('init-result', `âŒ ã‚¢ãƒ‰ãƒãƒ³ã‚¹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆä½œæˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        };
        
        window.testEffectChains = async function() {
            try {
                displayResult('init-result', 'ğŸ”— ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãƒã‚§ãƒ¼ãƒ³æ§‹ç¯‰ãƒ†ã‚¹ãƒˆ...', 'info');
                
                await ensureEffectsManager();
                const status = effectsManager.getEffectsStatus();
                
                const totalChains = status.chains.master + status.chains.music + status.chains.sfx;
                
                displayResult('init-result', 
                    `âœ… ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãƒã‚§ãƒ¼ãƒ³æ§‹ç¯‰å®Œäº†\n` +
                    `ãƒã‚¹ã‚¿ãƒ¼: ${status.chains.master}ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ\n` +
                    `éŸ³æ¥½: ${status.chains.music}ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ\n` +
                    `åŠ¹æœéŸ³: ${status.chains.sfx}ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ\n` +
                    `åˆè¨ˆ: ${totalChains}ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ`, 'success');
                    
            } catch (error) {
                displayResult('init-result', `âŒ ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãƒã‚§ãƒ¼ãƒ³æ§‹ç¯‰ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        };
        
        // 2. çµ±åˆéŸ³æ¥½ã‚¨ãƒ³ã‚¸ãƒ³ãƒ†ã‚¹ãƒˆ
        window.testEnhancedEngineInit = async function() {
            try {
                displayResult('enhanced-result', 'ğŸ¼âœ¨ çµ±åˆã‚¨ãƒ³ã‚¸ãƒ³åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆé–‹å§‹...', 'info');
                
                if (!enhancedEngine) {
                    enhancedEngine = new EnhancedMusicEngine();
                }
                
                const result = await enhancedEngine.initializeEnhancedEngine();
                
                if (result.success) {
                    displayResult('enhanced-result', 
                        `âœ… çµ±åˆã‚¨ãƒ³ã‚¸ãƒ³åˆæœŸåŒ–æˆåŠŸ (${result.latency.toFixed(2)}ms)\n` +
                        `éŸ³æ¥½ã‚¨ãƒ³ã‚¸ãƒ³: ${result.musicEngine ? 'âœ…' : 'âŒ'}\n` +
                        `ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚¨ãƒ³ã‚¸ãƒ³: ${result.effectsEngine ? 'âœ…' : 'âŒ'}`, 'success');
                } else {
                    displayResult('enhanced-result', 
                        `âŒ çµ±åˆã‚¨ãƒ³ã‚¸ãƒ³åˆæœŸåŒ–å¤±æ•—: ${result.error}`, 'error');
                }
                
                updateSystemStatus();
                
            } catch (error) {
                displayResult('enhanced-result', `âŒ çµ±åˆã‚¨ãƒ³ã‚¸ãƒ³åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        };
        
        window.testEnhancedBGMPlay = async function() {
            try {
                displayResult('enhanced-result', 'ğŸµâœ¨ ã‚¨ãƒ•ã‚§ã‚¯ãƒˆä»˜ãBGMå†ç”Ÿãƒ†ã‚¹ãƒˆ...', 'info');
                
                await ensureEnhancedEngine();
                
                const result = await enhancedEngine.playEnhancedBGM({
                    effects: true,
                    gameState: currentGameState
                });
                
                if (result.success) {
                    displayResult('enhanced-result', 
                        `âœ… ã‚¨ãƒ•ã‚§ã‚¯ãƒˆä»˜ãBGMå†ç”ŸæˆåŠŸ\n` +
                        `ã‚²ãƒ¼ãƒ çŠ¶æ…‹é€£å‹•: æœ‰åŠ¹\n` +
                        `å‹•çš„ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ: æœ‰åŠ¹`, 'success');
                } else {
                    displayResult('enhanced-result', 
                        `âŒ ã‚¨ãƒ•ã‚§ã‚¯ãƒˆä»˜ãBGMå†ç”Ÿå¤±æ•—: ${result.error}`, 'error');
                }
                
            } catch (error) {
                displayResult('enhanced-result', `âŒ ã‚¨ãƒ•ã‚§ã‚¯ãƒˆä»˜ãBGMå†ç”Ÿã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        };
        
        window.testEffectChainApplication = async function() {
            try {
                displayResult('enhanced-result', 'ğŸ”— æ¥½å™¨ã‚¨ãƒ•ã‚§ã‚¯ãƒˆé©ç”¨ãƒ†ã‚¹ãƒˆ...', 'info');
                
                await ensureEnhancedEngine();
                
                const result = await enhancedEngine.applyEffectsToInstruments();
                
                if (result.success) {
                    displayResult('enhanced-result', 
                        `âœ… æ¥½å™¨ã‚¨ãƒ•ã‚§ã‚¯ãƒˆé©ç”¨æˆåŠŸ\n` +
                        `é©ç”¨æ¸ˆã¿æ¥½å™¨: ${result.appliedInstruments}/3`, 'success');
                } else {
                    displayResult('enhanced-result', 
                        `âŒ æ¥½å™¨ã‚¨ãƒ•ã‚§ã‚¯ãƒˆé©ç”¨å¤±æ•—: ${result.error}`, 'error');
                }
                
            } catch (error) {
                displayResult('enhanced-result', `âŒ æ¥½å™¨ã‚¨ãƒ•ã‚§ã‚¯ãƒˆé©ç”¨ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        };
        
        window.testGameStateIntegration = async function() {
            try {
                displayResult('enhanced-result', 'ğŸ® ã‚²ãƒ¼ãƒ çŠ¶æ…‹é€£å‹•ãƒ†ã‚¹ãƒˆ...', 'info');
                
                await ensureEnhancedEngine();
                
                // ãƒ†ã‚¹ãƒˆç”¨ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚·ãƒ¼ã‚±ãƒ³ã‚¹
                const testStates = [
                    { combo: 0, intensity: 1.0, scene: 'menu' },
                    { combo: 10, intensity: 1.5, scene: 'battle' },
                    { combo: 25, intensity: 2.0, scene: 'boss' }
                ];
                
                let successCount = 0;
                
                for (let i = 0; i < testStates.length; i++) {
                    try {
                        enhancedEngine.updateGameState(testStates[i]);
                        successCount++;
                        await new Promise(resolve => setTimeout(resolve, 500));
                    } catch (error) {
                        console.error(`Game state test ${i} failed:`, error);
                    }
                }
                
                displayResult('enhanced-result', 
                    `âœ… ã‚²ãƒ¼ãƒ çŠ¶æ…‹é€£å‹•ãƒ†ã‚¹ãƒˆå®Œäº†\n` +
                    `æˆåŠŸ: ${successCount}/${testStates.length}çŠ¶æ…‹\n` +
                    `æœ€çµ‚çŠ¶æ…‹: combo=${testStates[testStates.length-1].combo}, scene=${testStates[testStates.length-1].scene}`, 
                    successCount === testStates.length ? 'success' : 'warning');
                
            } catch (error) {
                displayResult('enhanced-result', `âŒ ã‚²ãƒ¼ãƒ çŠ¶æ…‹é€£å‹•ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        };
        
        // 3. å€‹åˆ¥ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãƒ†ã‚¹ãƒˆ
        window.testReverbEffect = async function() {
            try {
                displayResult('individual-result', 'ğŸ›ï¸ ãƒªãƒãƒ¼ãƒ–ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãƒ†ã‚¹ãƒˆ...', 'info');
                
                await ensureEffectsManager();
                
                const intensities = [0.2, 0.5, 0.8];
                let results = [];
                
                for (const intensity of intensities) {
                    const result = effectsManager.adjustReverb(intensity);
                    results.push(`${(intensity * 100).toFixed(0)}%: ${result.success ? 'âœ…' : 'âŒ'}`);
                    await new Promise(resolve => setTimeout(resolve, 200));
                }
                
                displayResult('individual-result', 
                    `âœ… ãƒªãƒãƒ¼ãƒ–ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãƒ†ã‚¹ãƒˆå®Œäº†\n` +
                    `ãƒ†ã‚¹ãƒˆçµæœ:\n${results.join('\n')}`, 'success');
                
            } catch (error) {
                displayResult('individual-result', `âŒ ãƒªãƒãƒ¼ãƒ–ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        };
        
        window.testFilterEffect = async function() {
            try {
                displayResult('individual-result', 'ğŸ”Š ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãƒ†ã‚¹ãƒˆ...', 'info');
                
                await ensureEffectsManager();
                
                const tests = [
                    { freq: 1000, type: 'lowpass' },
                    { freq: 5000, type: 'highpass' },
                    { freq: 3000, type: 'bandpass' }
                ];
                
                let results = [];
                
                for (const test of tests) {
                    const result = effectsManager.adjustFilter(test.freq, test.type);
                    results.push(`${test.freq}Hz ${test.type}: ${result.success ? 'âœ…' : 'âŒ'}`);
                    await new Promise(resolve => setTimeout(resolve, 200));
                }
                
                displayResult('individual-result', 
                    `âœ… ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãƒ†ã‚¹ãƒˆå®Œäº†\n` +
                    `ãƒ†ã‚¹ãƒˆçµæœ:\n${results.join('\n')}`, 'success');
                
            } catch (error) {
                displayResult('individual-result', `âŒ ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        };
        
        window.testDistortionEffect = async function() {
            try {
                displayResult('individual-result', 'âš¡ ãƒ‡ã‚£ã‚¹ãƒˆãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãƒ†ã‚¹ãƒˆ...', 'info');
                
                await ensureEffectsManager();
                
                const amounts = [0.1, 0.4, 0.8];
                let results = [];
                
                for (const amount of amounts) {
                    const result = effectsManager.adjustDistortion(amount);
                    results.push(`${(amount * 100).toFixed(0)}%: ${result.success ? 'âœ…' : 'âŒ'}`);
                    await new Promise(resolve => setTimeout(resolve, 200));
                }
                
                displayResult('individual-result', 
                    `âœ… ãƒ‡ã‚£ã‚¹ãƒˆãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãƒ†ã‚¹ãƒˆå®Œäº†\n` +
                    `ãƒ†ã‚¹ãƒˆçµæœ:\n${results.join('\n')}`, 'success');
                
            } catch (error) {
                displayResult('individual-result', `âŒ ãƒ‡ã‚£ã‚¹ãƒˆãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        };
        
        // 4. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åˆ¶å¾¡
        window.adjustReverbRealtime = function(value) {
            try {
                const intensity = value / 100;
                document.getElementById('reverb-value').textContent = `${value}%`;
                
                if (effectsManager) {
                    const result = effectsManager.adjustReverb(intensity);
                    if (!result.success) {
                        displayResult('realtime-result', `âš ï¸ ãƒªãƒãƒ¼ãƒ–èª¿æ•´å¤±æ•—: ${result.error}`, 'warning');
                    }
                }
            } catch (error) {
                displayResult('realtime-result', `âŒ ãƒªãƒãƒ¼ãƒ–ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ èª¿æ•´ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        };
        
        window.adjustFilterRealtime = function(value) {
            try {
                document.getElementById('filter-value').textContent = `${value}Hz`;
                
                if (effectsManager) {
                    const result = effectsManager.adjustFilter(parseInt(value));
                    if (!result.success) {
                        displayResult('realtime-result', `âš ï¸ ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼èª¿æ•´å¤±æ•—: ${result.error}`, 'warning');
                    }
                }
            } catch (error) {
                displayResult('realtime-result', `âŒ ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ èª¿æ•´ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        };
        
        window.adjustDistortionRealtime = function(value) {
            try {
                const amount = value / 100;
                document.getElementById('distortion-value').textContent = `${value}%`;
                
                if (effectsManager) {
                    const result = effectsManager.adjustDistortion(amount);
                    if (!result.success) {
                        displayResult('realtime-result', `âš ï¸ ãƒ‡ã‚£ã‚¹ãƒˆãƒ¼ã‚·ãƒ§ãƒ³èª¿æ•´å¤±æ•—: ${result.error}`, 'warning');
                    }
                }
            } catch (error) {
                displayResult('realtime-result', `âŒ ãƒ‡ã‚£ã‚¹ãƒˆãƒ¼ã‚·ãƒ§ãƒ³ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ èª¿æ•´ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        };
        
        window.updateGameStateRealtime = function() {
            try {
                const combo = parseInt(document.getElementById('game-combo').value);
                const intensity = parseInt(document.getElementById('game-intensity').value) / 100;
                
                document.getElementById('combo-value').textContent = combo;
                document.getElementById('intensity-value').textContent = `${(intensity * 100).toFixed(0)}%`;
                
                currentGameState.combo = combo;
                currentGameState.intensity = intensity;
                
                if (enhancedEngine) {
                    enhancedEngine.updateGameState(currentGameState);
                }
                
            } catch (error) {
                displayResult('realtime-result', `âŒ ã‚²ãƒ¼ãƒ çŠ¶æ…‹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        };
        
        window.setGameScene = function(scene) {
            try {
                currentGameState.scene = scene;
                
                if (enhancedEngine) {
                    enhancedEngine.updateGameState(currentGameState);
                }
                
                displayResult('realtime-result', `ğŸ® ã‚²ãƒ¼ãƒ ã‚·ãƒ¼ãƒ³å¤‰æ›´: ${scene}`, 'info');
                
            } catch (error) {
                displayResult('realtime-result', `âŒ ã‚²ãƒ¼ãƒ ã‚·ãƒ¼ãƒ³å¤‰æ›´ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        };
        
        // 5. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
        window.runFullPerformanceTest = async function() {
            try {
                displayResult('performance-result', 'âš¡ å®Œå…¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆé–‹å§‹...', 'info');
                
                await ensureEnhancedEngine();
                
                const result = await enhancedEngine.performanceTest();
                
                if (result.success) {
                    const r = result.results;
                    displayResult('performance-result', 
                        `âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå®Œäº†\n` +
                        `ç·æ™‚é–“: ${r.totalTime.toFixed(2)}ms\n` +
                        `åˆæœŸåŒ–: ${r.initLatency.toFixed(2)}ms\n` +
                        `å†ç”Ÿé–‹å§‹: ${r.playLatency.toFixed(2)}ms\n` +
                        `ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ: ${r.effectLatency.toFixed(2)}ms\n` +
                        `è©•ä¾¡: ${r.performance}\n` +
                        `ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: ${r.memoryUsage.estimated}`, 
                        r.performance === 'good' ? 'success' : 'warning');
                } else {
                    displayResult('performance-result', 
                        `âŒ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå¤±æ•—: ${result.error}`, 'error');
                }
                
            } catch (error) {
                displayResult('performance-result', `âŒ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        };
        
        // 6. ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹æ›´æ–°
        window.updateSystemStatus = function() {
            try {
                // ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼çŠ¶æ…‹
                if (effectsManager) {
                    const effectsStatus = effectsManager.getEffectsStatus();
                    
                    document.getElementById('stat-effects-init').textContent = 
                        effectsStatus.initialized ? 'âœ… å®Œäº†' : 'âŒ æœªå®Œäº†';
                    
                    document.getElementById('stat-active-effects').textContent = 
                        effectsStatus.stats.activeEffects || '0';
                    
                    const totalChains = effectsStatus.chains.master + effectsStatus.chains.music + effectsStatus.chains.sfx;
                    document.getElementById('stat-effect-chains').textContent = totalChains;
                }
                
                // çµ±åˆã‚¨ãƒ³ã‚¸ãƒ³çŠ¶æ…‹
                if (enhancedEngine) {
                    const enhancedStatus = enhancedEngine.getEnhancedEngineStatus();
                    
                    document.getElementById('stat-latency').textContent = 
                        enhancedStatus.performance?.latency?.toFixed(2) + 'ms' || '-';
                    
                    document.getElementById('stat-memory').textContent = 
                        enhancedStatus.effects?.stats?.memoryUsage || '-';
                }
                
                displayResult('status-result', 
                    `ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹æ›´æ–°å®Œäº† (${new Date().toLocaleTimeString()})`, 'info');
                
            } catch (error) {
                displayResult('status-result', `âŒ çŠ¶æ…‹æ›´æ–°ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        };
        
        // å®Œå…¨ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ
        window.runFullTestSuite = async function() {
            try {
                displayResult('status-result', 'ğŸ”¬ å®Œå…¨ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆå®Ÿè¡Œé–‹å§‹...', 'info');
                
                const tests = [
                    testEffectsInitialization,
                    testBasicEffectsCreation,
                    testAdvancedEffectsCreation,
                    testEffectChains,
                    testEnhancedEngineInit,
                    testEnhancedBGMPlay,
                    testReverbEffect,
                    testFilterEffect,
                    testDistortionEffect
                ];
                
                let passedTests = 0;
                
                for (let i = 0; i < tests.length; i++) {
                    try {
                        await tests[i]();
                        passedTests++;
                        await new Promise(resolve => setTimeout(resolve, 800));
                    } catch (error) {
                        console.error(`Test ${i} failed:`, error);
                    }
                }
                
                displayResult('status-result', 
                    `ğŸ¯ å®Œå…¨ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆå®Œäº†\n` +
                    `çµæœ: ${passedTests}/${tests.length} ãƒ†ã‚¹ãƒˆæˆåŠŸ\n` +
                    `æˆåŠŸç‡: ${((passedTests / tests.length) * 100).toFixed(1)}%`, 
                    passedTests >= tests.length * 0.8 ? 'success' : 'warning');
                    
            } catch (error) {
                displayResult('status-result', `âŒ ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        };
        
        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
        async function ensureEffectsManager() {
            if (!effectsManager) {
                effectsManager = new AudioEffectsManager();
                await effectsManager.initialize();
            }
            return effectsManager;
        }
        
        async function ensureEnhancedEngine() {
            if (!enhancedEngine) {
                enhancedEngine = new EnhancedMusicEngine();
                await enhancedEngine.initializeEnhancedEngine();
            }
            return enhancedEngine;
        }
        
        function displayResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = message;
                element.className = `test-result ${type}`;
            }
        }
        
        window.clearAllTests = function() {
            const resultElements = document.querySelectorAll('.test-result');
            resultElements.forEach(element => {
                element.textContent = '';
                element.className = 'test-result';
            });
        };
        
        // åˆæœŸåŒ–
        setTimeout(() => {
            console.log('ğŸ›ï¸ Phase 2.2 Effects System Test Page Ready');
        }, 100);
        
    </script>
</body>
</html>