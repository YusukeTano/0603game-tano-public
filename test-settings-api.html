<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”§ Settings API ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ - éŸ³é‡ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: #fff;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        h1 {
            text-align: center;
            color: #FF5722;
            text-shadow: 0 0 10px rgba(255, 87, 34, 0.5);
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border-left: 4px solid #FF5722;
        }
        .test-button {
            background: linear-gradient(45deg, #FF5722, #FF8A65);
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-family: inherit;
            transition: transform 0.2s;
        }
        .test-button:hover {
            transform: scale(1.05);
        }
        .volume-control {
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .volume-control label {
            min-width: 80px;
            color: #FFC107;
        }
        .volume-control input[type="range"] {
            flex: 1;
            height: 8px;
            background: #333;
            border-radius: 4px;
        }
        .volume-control .volume-value {
            min-width: 50px;
            text-align: right;
            color: #4CAF50;
            font-weight: bold;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
        }
        .success { background: rgba(76, 175, 80, 0.2); border: 1px solid #4CAF50; }
        .error { background: rgba(244, 67, 54, 0.2); border: 1px solid #f44336; }
        .info { background: rgba(33, 150, 243, 0.2); border: 1px solid #2196F3; }
        #log {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #555;
            border-radius: 5px;
            padding: 15px;
            height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #0f0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ Settings API ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸</h1>
        <p style="text-align: center; color: #aaa;">IntegratedAudioManageréŸ³é‡ç®¡ç†APIæ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ </p>

        <div class="test-section">
            <h3>ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–</h3>
            <button class="test-button" onclick="initializeAudio()">éŸ³éŸ¿ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–</button>
            <button class="test-button" onclick="checkAPI()">APIç¢ºèª</button>
            <div id="system-status" class="status info">å¾…æ©Ÿä¸­...</div>
        </div>

        <div class="test-section">
            <h3>ğŸ”Š éŸ³é‡å–å¾—ãƒ†ã‚¹ãƒˆ</h3>
            <button class="test-button" onclick="testGetVolume()">å…¨éŸ³é‡å–å¾—</button>
            <button class="test-button" onclick="testGetMaster()">ãƒã‚¹ã‚¿ãƒ¼éŸ³é‡å–å¾—</button>
            <button class="test-button" onclick="testGetBGM()">BGMéŸ³é‡å–å¾—</button>
            <button class="test-button" onclick="testGetSFX()">SFXéŸ³é‡å–å¾—</button>
        </div>

        <div class="test-section">
            <h3>ğŸšï¸ éŸ³é‡è¨­å®šãƒ†ã‚¹ãƒˆ</h3>
            <div class="volume-control">
                <label>Master:</label>
                <input type="range" id="master-slider" min="0" max="100" value="80" onchange="testSetVolume('master', this.value)">
                <span class="volume-value" id="master-value">80%</span>
            </div>
            <div class="volume-control">
                <label>BGM:</label>
                <input type="range" id="bgm-slider" min="0" max="100" value="30" onchange="testSetVolume('bgm', this.value)">
                <span class="volume-value" id="bgm-value">30%</span>
            </div>
            <div class="volume-control">
                <label>SFX:</label>
                <input type="range" id="sfx-slider" min="0" max="100" value="70" onchange="testSetVolume('sfx', this.value)">
                <span class="volume-value" id="sfx-value">70%</span>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ§ª çµ±åˆãƒ†ã‚¹ãƒˆ</h3>
            <button class="test-button" onclick="runComprehensiveTest()">å®Œå…¨APIãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <button class="test-button" onclick="resetVolumes()">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆéŸ³é‡å¾©å…ƒ</button>
            <button class="test-button" onclick="clearLog()">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
        </div>

        <div class="test-section">
            <h3>ğŸ“ ãƒ†ã‚¹ãƒˆãƒ­ã‚°</h3>
            <div id="log"></div>
        </div>
    </div>

    <script type="module">
        import { IntegratedAudioManager } from './js/systems/integrated-audio-manager.js';

        // ãƒ€ãƒŸãƒ¼ã‚²ãƒ¼ãƒ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
        const mockGame = {
            canvas: document.createElement('canvas'),
            ctx: document.createElement('canvas').getContext('2d')
        };

        let audioManager = null;

        // ãƒ­ã‚°å‡ºåŠ›é–¢æ•°
        function log(message, type = 'info') {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const icon = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : 'ğŸ“';
            logElement.innerHTML += `[${timestamp}] ${icon} ${message}\\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(`${icon} ${message}`);
        }

        // éŸ³éŸ¿ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
        window.initializeAudio = async function() {
            try {
                audioManager = new IntegratedAudioManager(mockGame);
                await audioManager.initialize();
                document.getElementById('system-status').innerHTML = 
                    '<span style="color: #4caf50;">âœ… éŸ³éŸ¿ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†</span>';
                log('IntegratedAudioManageråˆæœŸåŒ–å®Œäº†', 'success');
                
                // åˆæœŸéŸ³é‡ã‚’è¡¨ç¤ºã«åæ˜ 
                updateSliders();
            } catch (error) {
                document.getElementById('system-status').innerHTML = 
                    `<span style="color: #f44336;">âŒ åˆæœŸåŒ–å¤±æ•—: ${error.message}</span>`;
                log(`éŸ³éŸ¿ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        };

        // APIç¢ºèª
        window.checkAPI = function() {
            if (!audioManager) {
                log('å…ˆã«éŸ³éŸ¿ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–ã—ã¦ãã ã•ã„', 'error');
                return;
            }

            const hasGetVolume = typeof audioManager.getVolume === 'function';
            const hasSetVolume = typeof audioManager.setVolume === 'function';
            
            log(`getVolume APIå­˜åœ¨: ${hasGetVolume}`, hasGetVolume ? 'success' : 'error');
            log(`setVolume APIå­˜åœ¨: ${hasSetVolume}`, hasSetVolume ? 'success' : 'error');
            
            if (hasGetVolume && hasSetVolume) {
                log('âœ… Settings APIå®Œå…¨å¯¾å¿œ', 'success');
            } else {
                log('âŒ Settings APIä¸å®Œå…¨', 'error');
            }
        };

        // éŸ³é‡å–å¾—ãƒ†ã‚¹ãƒˆ
        window.testGetVolume = function() {
            if (!audioManager) {
                log('å…ˆã«éŸ³éŸ¿ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–ã—ã¦ãã ã•ã„', 'error');
                return;
            }

            try {
                const master = audioManager.getVolume('master');
                const bgm = audioManager.getVolume('bgm');
                const sfx = audioManager.getVolume('sfx');
                
                log(`ç¾åœ¨ã®éŸ³é‡ - Master: ${(master * 100).toFixed(1)}%, BGM: ${(bgm * 100).toFixed(1)}%, SFX: ${(sfx * 100).toFixed(1)}%`, 'success');
            } catch (error) {
                log(`éŸ³é‡å–å¾—ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        };

        window.testGetMaster = function() {
            testSingleVolume('master');
        };

        window.testGetBGM = function() {
            testSingleVolume('bgm');
        };

        window.testGetSFX = function() {
            testSingleVolume('sfx');
        };

        function testSingleVolume(type) {
            if (!audioManager) {
                log('å…ˆã«éŸ³éŸ¿ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–ã—ã¦ãã ã•ã„', 'error');
                return;
            }

            try {
                const volume = audioManager.getVolume(type);
                log(`${type.toUpperCase()}éŸ³é‡: ${(volume * 100).toFixed(1)}%`, 'success');
            } catch (error) {
                log(`${type}éŸ³é‡å–å¾—ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // éŸ³é‡è¨­å®šãƒ†ã‚¹ãƒˆ
        window.testSetVolume = function(type, value) {
            if (!audioManager) {
                log('å…ˆã«éŸ³éŸ¿ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–ã—ã¦ãã ã•ã„', 'error');
                return;
            }

            try {
                const volume = value / 100;
                audioManager.setVolume(type, volume);
                document.getElementById(`${type}-value`).textContent = `${value}%`;
                log(`${type.toUpperCase()}éŸ³é‡è¨­å®š: ${value}%`, 'success');
            } catch (error) {
                log(`${type}éŸ³é‡è¨­å®šã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        };

        // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼æ›´æ–°
        function updateSliders() {
            if (!audioManager) return;

            try {
                const types = ['master', 'bgm', 'sfx'];
                types.forEach(type => {
                    const volume = audioManager.getVolume(type);
                    const percentage = Math.round(volume * 100);
                    document.getElementById(`${type}-slider`).value = percentage;
                    document.getElementById(`${type}-value`).textContent = `${percentage}%`;
                });
                log('ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼æ›´æ–°å®Œäº†', 'info');
            } catch (error) {
                log(`ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼æ›´æ–°ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆ
        window.runComprehensiveTest = async function() {
            log('ğŸš€ åŒ…æ‹¬çš„Settings APIãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
            
            try {
                if (!audioManager) {
                    await initializeAudio();
                }
                
                checkAPI();
                await new Promise(r => setTimeout(r, 500));
                
                testGetVolume();
                await new Promise(r => setTimeout(r, 500));
                
                // å„éŸ³é‡ã‚’æ®µéšçš„ã«ãƒ†ã‚¹ãƒˆ
                const testValues = [50, 25, 75, 80];
                for (const value of testValues) {
                    audioManager.setVolume('master', value / 100);
                    audioManager.setVolume('bgm', value / 100);
                    audioManager.setVolume('sfx', value / 100);
                    log(`å…¨éŸ³é‡ã‚’${value}%ã«è¨­å®š`, 'info');
                    await new Promise(r => setTimeout(r, 300));
                }
                
                updateSliders();
                log('ğŸ‰ åŒ…æ‹¬çš„Settings APIãƒ†ã‚¹ãƒˆå®Œäº†ï¼', 'success');
                
            } catch (error) {
                log(`åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        };

        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆéŸ³é‡å¾©å…ƒ
        window.resetVolumes = function() {
            if (!audioManager) {
                log('å…ˆã«éŸ³éŸ¿ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–ã—ã¦ãã ã•ã„', 'error');
                return;
            }

            try {
                audioManager.setVolume('master', 0.8);
                audioManager.setVolume('bgm', 0.3);
                audioManager.setVolume('sfx', 0.7);
                updateSliders();
                log('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆéŸ³é‡ã«å¾©å…ƒã—ã¾ã—ãŸ', 'success');
            } catch (error) {
                log(`éŸ³é‡å¾©å…ƒã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        };

        // ãƒ­ã‚°ã‚¯ãƒªã‚¢
        window.clearLog = function() {
            document.getElementById('log').innerHTML = '';
            log('ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'info');
        };

        // åˆæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        log('ğŸ”§ Settings API ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸æº–å‚™å®Œäº†', 'success');
        log('ã€ŒéŸ³éŸ¿ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ã€ãƒœã‚¿ãƒ³ã‹ã‚‰ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¦ãã ã•ã„', 'info');
    </script>
</body>
</html>