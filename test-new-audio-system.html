<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–°éŸ³éŸ¿ã‚·ã‚¹ãƒ†ãƒ çµ±åˆãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #0a0a0a;
            color: #00ff00;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #00ff00;
            padding-bottom: 20px;
        }
        .test-section {
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid #00ff00;
            margin: 20px 0;
            padding: 20px;
            border-radius: 5px;
        }
        .button {
            background: #003300;
            color: #00ff00;
            border: 1px solid #00ff00;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            border-radius: 3px;
            font-family: inherit;
        }
        .button:hover {
            background: #004400;
        }
        .status-display {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #333;
            padding: 15px;
            margin: 10px 0;
            border-radius: 3px;
            font-size: 14px;
            white-space: pre-line;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { color: #00ff00; }
        .warning { color: #ffaa00; }
        .error { color: #ff0000; }
        .info { color: #00aaff; }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .metric-card {
            background: rgba(0, 100, 0, 0.1);
            border: 1px solid #006600;
            padding: 15px;
            border-radius: 5px;
        }
        
        .metric-title {
            color: #00ff00;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .metric-value {
            color: #ffffff;
            font-size: 1.2em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸµ æ–°éŸ³éŸ¿ã‚·ã‚¹ãƒ†ãƒ çµ±åˆãƒ†ã‚¹ãƒˆ</h1>
            <p>éŸ³éŸ¿ã‚·ã‚¹ãƒ†ãƒ æ ¹æœ¬çš„å†æ§‹ç¯‰ - å‹•ä½œç¢ºèªãƒ»è¨ºæ–­ãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ</p>
        </div>

        <!-- ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹è¡¨ç¤º -->
        <div class="test-section">
            <h2>ğŸ” ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ç›£è¦–</h2>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-title">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚·ã‚¹ãƒ†ãƒ </div>
                    <div class="metric-value" id="active-system">æœªåˆæœŸåŒ–</div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹</div>
                    <div class="metric-value" id="system-status">æœªç¢ºèª</div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ•ãƒ©ã‚°</div>
                    <div class="metric-value" id="feature-flags">ç¢ºèªä¸­...</div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–éŸ³éŸ¿æ•°</div>
                    <div class="metric-value" id="active-sounds">0</div>
                </div>
            </div>
            <button class="button" onclick="updateSystemStatus()">ğŸ”„ çŠ¶æ…‹æ›´æ–°</button>
            <button class="button" onclick="showDiagnostics()">ğŸ¥ è©³ç´°è¨ºæ–­</button>
        </div>

        <!-- éŸ³éŸ¿ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h2>ğŸµ éŸ³éŸ¿å†ç”Ÿãƒ†ã‚¹ãƒˆ</h2>
            <h3>æ­¦å™¨å°„æ’ƒéŸ³ãƒ†ã‚¹ãƒˆ</h3>
            <button class="button" onclick="testShootSound('plasma')">ğŸ”« Plasma</button>
            <button class="button" onclick="testShootSound('nuke')">ğŸ’¥ Nuke</button>
            <button class="button" onclick="testShootSound('superHoming')">ğŸ¯ Super Homing</button>
            <button class="button" onclick="testShootSound('superShotgun')">ğŸ’¥ Super Shotgun</button>
            
            <h3>æ•µãƒ»UIéŸ³éŸ¿ãƒ†ã‚¹ãƒˆ</h3>
            <button class="button" onclick="testEnemySound('hit', 'medium')">ğŸ‘¾ æ•µãƒ’ãƒƒãƒˆ</button>
            <button class="button" onclick="testEnemySound('death', 'large')">ğŸ’€ æ•µæ­»äº¡</button>
            <button class="button" onclick="testUISound('levelup')">â¬†ï¸ ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—</button>
            <button class="button" onclick="testUISound('pickup')">ğŸ“¦ ã‚¢ã‚¤ãƒ†ãƒ å–å¾—</button>
        </div>

        <!-- ã‚·ã‚¹ãƒ†ãƒ åˆ‡ã‚Šæ›¿ãˆãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h2>ğŸ”„ ã‚·ã‚¹ãƒ†ãƒ åˆ‡ã‚Šæ›¿ãˆãƒ†ã‚¹ãƒˆ</h2>
            <button class="button" onclick="switchToNewSystem()">ğŸ†• æ–°ã‚·ã‚¹ãƒ†ãƒ ã«åˆ‡ã‚Šæ›¿ãˆ</button>
            <button class="button" onclick="switchToOldSystem()">ğŸ”™ æ—§ã‚·ã‚¹ãƒ†ãƒ ã«åˆ‡ã‚Šæ›¿ãˆ</button>
            <button class="button" onclick="triggerFallback()">ğŸš¨ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆ</button>
        </div>

        <!-- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h2>âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ</h2>
            <button class="button" onclick="stressTest()">ğŸ”¥ ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆ (10éŸ³éŸ¿)</button>
            <button class="button" onclick="latencyTest()">â±ï¸ ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ãƒ†ã‚¹ãƒˆ</button>
            <button class="button" onclick="memoryTest()">ğŸ§  ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãƒ†ã‚¹ãƒˆ</button>
        </div>

        <!-- ãƒ­ã‚°ãƒ»è¨ºæ–­è¡¨ç¤º -->
        <div class="test-section">
            <h2>ğŸ“Š ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¨ºæ–­æƒ…å ±</h2>
            <div id="diagnostic-display" class="status-display">
                è¨ºæ–­æƒ…å ±ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...
            </div>
            <button class="button" onclick="clearLog()">ğŸ§¹ ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
            <button class="button" onclick="exportDiagnostics()">ğŸ’¾ è¨ºæ–­ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
        </div>
    </div>

    <!-- Tone.jsèª­ã¿è¾¼ã¿ -->
    <script src="https://unpkg.com/tone@latest/build/Tone.js"></script>
    
    <!-- éŸ³éŸ¿ã‚·ã‚¹ãƒ†ãƒ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿ -->
    <script type="module">
        import { AudioMigrationController } from './js/systems/audio-migration-controller.js';
        import { AudioFeatureFlags } from './js/systems/audio-feature-flags.js';
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let audioController = null;
        let featureFlags = null;
        let testResults = [];
        let startTime = Date.now();
        
        // åˆæœŸåŒ–
        async function initializeTestSystem() {
            try {
                logToDisplay('ğŸ”„ ãƒ†ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–é–‹å§‹...', 'info');
                
                // ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ•ãƒ©ã‚°åˆæœŸåŒ–
                featureFlags = new AudioFeatureFlags();
                featureFlags.setFlag('useNewAudioSystem', true);
                featureFlags.setFlag('enableDebugLogging', true);
                
                // ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼åˆæœŸåŒ–
                audioController = new AudioMigrationController();
                const result = await audioController.initialize();
                
                if (result.success) {
                    logToDisplay(`âœ… åˆæœŸåŒ–å®Œäº†: ${result.activeSystem}`, 'success');
                } else {
                    logToDisplay(`âš ï¸ åˆæœŸåŒ–ã§å•é¡Œç™ºç”Ÿ: ${result.error}`, 'warning');
                }
                
                // å®šæœŸçš„ãªçŠ¶æ…‹æ›´æ–°é–‹å§‹
                setInterval(updateSystemStatus, 2000);
                updateSystemStatus();
                
            } catch (error) {
                logToDisplay(`âŒ åˆæœŸåŒ–å¤±æ•—: ${error.message}`, 'error');
            }
        }
        
        // ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹æ›´æ–°
        function updateSystemStatus() {
            if (!audioController) return;
            
            try {
                const diagnostics = audioController.diagnose();
                
                // ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°
                document.getElementById('active-system').textContent = 
                    diagnostics.migrationController.activeSystem;
                document.getElementById('system-status').textContent = 
                    diagnostics.migrationController.migrationState.phase;
                document.getElementById('feature-flags').textContent = 
                    diagnostics.featureFlags.effectiveFlags.useNewAudioSystem ? 'æ–°ã‚·ã‚¹ãƒ†ãƒ ' : 'æ—§ã‚·ã‚¹ãƒ†ãƒ ';
                
                // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–éŸ³éŸ¿æ•°
                const activeSounds = diagnostics.activeSystemDiagnostics?.performance?.activeSounds || 0;
                document.getElementById('active-sounds').textContent = activeSounds;
                
            } catch (error) {
                logToDisplay(`âš ï¸ çŠ¶æ…‹æ›´æ–°ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'warning');
            }
        }
        
        // è¨ºæ–­æƒ…å ±è¡¨ç¤º
        function showDiagnostics() {
            if (!audioController) {
                logToDisplay('âŒ ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãŒæœªåˆæœŸåŒ–', 'error');
                return;
            }
            
            try {
                const diagnostics = audioController.diagnose();
                logToDisplay('ğŸ“Š è©³ç´°è¨ºæ–­æƒ…å ±:', 'info');
                logToDisplay(JSON.stringify(diagnostics, null, 2), 'info');
                
            } catch (error) {
                logToDisplay(`âŒ è¨ºæ–­å–å¾—ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        // éŸ³éŸ¿ãƒ†ã‚¹ãƒˆé–¢æ•°ç¾¤
        async function testShootSound(weaponType) {
            if (!audioController?.sounds?.shoot) {
                logToDisplay('âŒ å°„æ’ƒéŸ³ã‚·ã‚¹ãƒ†ãƒ ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“', 'error');
                return;
            }
            
            try {
                const startTime = performance.now();
                const result = audioController.sounds.shoot(weaponType, 10, 5);
                const endTime = performance.now();
                
                logToDisplay(`ğŸ”« ${weaponType} å°„æ’ƒéŸ³ãƒ†ã‚¹ãƒˆ - ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼: ${(endTime - startTime).toFixed(2)}ms`, 'success');
                
            } catch (error) {
                logToDisplay(`âŒ ${weaponType} å°„æ’ƒéŸ³ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        async function testEnemySound(action, enemyType) {
            if (!audioController?.sounds) {
                logToDisplay('âŒ æ•µéŸ³éŸ¿ã‚·ã‚¹ãƒ†ãƒ ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“', 'error');
                return;
            }
            
            try {
                const startTime = performance.now();
                
                if (action === 'hit') {
                    audioController.sounds.enemyHit();
                } else {
                    audioController.sounds.enemyKill();
                }
                
                const endTime = performance.now();
                logToDisplay(`ğŸ‘¾ æ•µ${action}éŸ³ãƒ†ã‚¹ãƒˆ (${enemyType}) - ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼: ${(endTime - startTime).toFixed(2)}ms`, 'success');
                
            } catch (error) {
                logToDisplay(`âŒ æ•µéŸ³éŸ¿ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        async function testUISound(soundType) {
            if (!audioController?.sounds) {
                logToDisplay('âŒ UIéŸ³éŸ¿ã‚·ã‚¹ãƒ†ãƒ ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“', 'error');
                return;
            }
            
            try {
                const startTime = performance.now();
                
                switch (soundType) {
                    case 'levelup':
                        audioController.sounds.levelUp();
                        break;
                    case 'pickup':
                        audioController.sounds.pickup();
                        break;
                    default:
                        audioController.sounds.upgrade();
                }
                
                const endTime = performance.now();
                logToDisplay(`ğŸµ UIéŸ³ãƒ†ã‚¹ãƒˆ (${soundType}) - ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼: ${(endTime - startTime).toFixed(2)}ms`, 'success');
                
            } catch (error) {
                logToDisplay(`âŒ UIéŸ³éŸ¿ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        // ã‚·ã‚¹ãƒ†ãƒ åˆ‡ã‚Šæ›¿ãˆãƒ†ã‚¹ãƒˆ
        async function switchToNewSystem() {
            if (!audioController) return;
            
            try {
                logToDisplay('ğŸ”„ æ–°ã‚·ã‚¹ãƒ†ãƒ ã«åˆ‡ã‚Šæ›¿ãˆä¸­...', 'info');
                const result = await audioController.switchSystem('new');
                
                if (result.success) {
                    logToDisplay(`âœ… æ–°ã‚·ã‚¹ãƒ†ãƒ åˆ‡ã‚Šæ›¿ãˆå®Œäº† (${result.switchTime}ms)`, 'success');
                } else {
                    logToDisplay(`âŒ æ–°ã‚·ã‚¹ãƒ†ãƒ åˆ‡ã‚Šæ›¿ãˆå¤±æ•—: ${result.error}`, 'error');
                }
                
            } catch (error) {
                logToDisplay(`âŒ åˆ‡ã‚Šæ›¿ãˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        async function switchToOldSystem() {
            if (!audioController) return;
            
            try {
                logToDisplay('ğŸ”„ æ—§ã‚·ã‚¹ãƒ†ãƒ ã«åˆ‡ã‚Šæ›¿ãˆä¸­...', 'info');
                const result = await audioController.switchSystem('old');
                
                if (result.success) {
                    logToDisplay(`âœ… æ—§ã‚·ã‚¹ãƒ†ãƒ åˆ‡ã‚Šæ›¿ãˆå®Œäº† (${result.switchTime}ms)`, 'success');
                } else {
                    logToDisplay(`âŒ æ—§ã‚·ã‚¹ãƒ†ãƒ åˆ‡ã‚Šæ›¿ãˆå¤±æ•—: ${result.error}`, 'error');
                }
                
            } catch (error) {
                logToDisplay(`âŒ åˆ‡ã‚Šæ›¿ãˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        async function triggerFallback() {
            if (!audioController) return;
            
            try {
                logToDisplay('ğŸš¨ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ...', 'warning');
                await audioController.fallbackToStableSystem();
                logToDisplay('âœ… ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Œäº†', 'success');
                
            } catch (error) {
                logToDisplay(`âŒ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
        async function stressTest() {
            if (!audioController?.sounds) {
                logToDisplay('âŒ éŸ³éŸ¿ã‚·ã‚¹ãƒ†ãƒ ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“', 'error');
                return;
            }
            
            logToDisplay('ğŸ”¥ ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆé–‹å§‹ (10éŸ³éŸ¿åŒæ™‚å†ç”Ÿ)...', 'warning');
            const startTime = performance.now();
            
            const promises = [];
            for (let i = 0; i < 10; i++) {
                try {
                    const weaponTypes = ['plasma', 'nuke', 'superHoming', 'superShotgun'];
                    const weaponType = weaponTypes[i % weaponTypes.length];
                    promises.push(testShootSound(weaponType));
                } catch (error) {
                    logToDisplay(`âŒ ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆ ${i}: ${error.message}`, 'error');
                }
            }
            
            try {
                await Promise.allSettled(promises);
                const endTime = performance.now();
                logToDisplay(`âœ… ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆå®Œäº† - ç·æ™‚é–“: ${(endTime - startTime).toFixed(2)}ms`, 'success');
                
            } catch (error) {
                logToDisplay(`âŒ ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        async function latencyTest() {
            if (!audioController?.sounds) return;
            
            logToDisplay('â±ï¸ ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ãƒ†ã‚¹ãƒˆé–‹å§‹...', 'info');
            const latencies = [];
            
            for (let i = 0; i < 5; i++) {
                const startTime = performance.now();
                try {
                    audioController.sounds.shoot('plasma');
                    const endTime = performance.now();
                    latencies.push(endTime - startTime);
                } catch (error) {
                    logToDisplay(`âŒ ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ãƒ†ã‚¹ãƒˆ ${i}: ${error.message}`, 'error');
                }
                
                // 50mså¾…æ©Ÿ
                await new Promise(resolve => setTimeout(resolve, 50));
            }
            
            if (latencies.length > 0) {
                const avgLatency = latencies.reduce((a, b) => a + b, 0) / latencies.length;
                const minLatency = Math.min(...latencies);
                const maxLatency = Math.max(...latencies);
                
                logToDisplay(`â±ï¸ ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼çµæœ: å¹³å‡ ${avgLatency.toFixed(2)}ms, æœ€å° ${minLatency.toFixed(2)}ms, æœ€å¤§ ${maxLatency.toFixed(2)}ms`, 'success');
            }
        }
        
        async function memoryTest() {
            if (!performance.memory) {
                logToDisplay('âŒ ãƒ¡ãƒ¢ãƒªæƒ…å ±ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“', 'warning');
                return;
            }
            
            const beforeMemory = performance.memory.usedJSHeapSize;
            
            // è¤‡æ•°éŸ³éŸ¿å†ç”Ÿ
            for (let i = 0; i < 20; i++) {
                try {
                    audioController?.sounds?.shoot('plasma');
                } catch (error) {
                    // ã‚¨ãƒ©ãƒ¼ã¯ç„¡è¦–
                }
            }
            
            // GCå®Ÿè¡Œ
            if (window.gc) {
                window.gc();
            }
            
            setTimeout(() => {
                const afterMemory = performance.memory.usedJSHeapSize;
                const memoryDiff = afterMemory - beforeMemory;
                
                logToDisplay(`ğŸ§  ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: ${(beforeMemory / 1024 / 1024).toFixed(2)}MB â†’ ${(afterMemory / 1024 / 1024).toFixed(2)}MB (å·®åˆ†: ${(memoryDiff / 1024).toFixed(2)}KB)`, 'info');
            }, 1000);
        }
        
        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
        function logToDisplay(message, type = 'info') {
            const display = document.getElementById('diagnostic-display');
            const timestamp = new Date().toLocaleTimeString();
            const typeClass = type || 'info';
            
            const logEntry = `[${timestamp}] ${message}`;
            
            if (display.textContent === 'è¨ºæ–­æƒ…å ±ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...') {
                display.textContent = '';
            }
            
            display.textContent += logEntry + '\n';
            display.scrollTop = display.scrollHeight;
            
            // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã‚‚å‡ºåŠ›
            console.log(`[AudioTest] ${logEntry}`);
        }
        
        function clearLog() {
            document.getElementById('diagnostic-display').textContent = 'è¨ºæ–­æƒ…å ±ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...';
        }
        
        function exportDiagnostics() {
            if (!audioController) return;
            
            try {
                const diagnostics = audioController.diagnose();
                const testSession = {
                    timestamp: new Date().toISOString(),
                    sessionDuration: Date.now() - startTime,
                    testResults,
                    systemDiagnostics: diagnostics
                };
                
                const dataStr = JSON.stringify(testSession, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `audio-system-diagnostics-${Date.now()}.json`;
                link.click();
                
                logToDisplay('ğŸ’¾ è¨ºæ–­ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ', 'success');
                
            } catch (error) {
                logToDisplay(`âŒ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å…¬é–‹
        window.updateSystemStatus = updateSystemStatus;
        window.showDiagnostics = showDiagnostics;
        window.testShootSound = testShootSound;
        window.testEnemySound = testEnemySound;
        window.testUISound = testUISound;
        window.switchToNewSystem = switchToNewSystem;
        window.switchToOldSystem = switchToOldSystem;
        window.triggerFallback = triggerFallback;
        window.stressTest = stressTest;
        window.latencyTest = latencyTest;
        window.memoryTest = memoryTest;
        window.clearLog = clearLog;
        window.exportDiagnostics = exportDiagnostics;
        
        // åˆæœŸåŒ–å®Ÿè¡Œ
        initializeTestSystem();
    </script>
</body>
</html>